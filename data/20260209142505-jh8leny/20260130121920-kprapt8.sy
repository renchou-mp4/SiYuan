{"ID":"20260130121920-kprapt8","Spec":"2","Type":"NodeDocument","Properties":{"id":"20260130121920-kprapt8","title":"ObjectPool","type":"doc","updated":"20260203194625"},"Children":[{"ID":"20260130164318-84kquc0","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20260130164318-84kquc0","updated":"20260202181158"},"Children":[{"Type":"NodeText","Data":"ObjectBase 和 Object"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003c"}]},{"Type":"NodeText","Data":"T"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003e"}]},{"Type":"NodeText","Data":" 的职责划分"}]},{"ID":"20260130164332-1lahsh5","Type":"NodeParagraph","Properties":{"id":"20260130164332-1lahsh5","updated":"20260130164507"},"Children":[{"Type":"NodeText","Data":"简单来说就是Object"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003c"}]},{"Type":"NodeText","Data":"T"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003e"}]},{"Type":"NodeText","Data":"对内，用于对象池内部管理，使用者不知道其存在。ObjectBase对外，用于使用者指定池化对象"}]},{"ID":"20260130164318-wmyogsc","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260130164318-wmyogsc","updated":"20260130164318"},"Children":[{"Type":"NodeText","Data":"ObjectBase — 业务层对象基类"}]},{"ID":"20260130164318-yjnm9nz","Type":"NodeParagraph","Properties":{"id":"20260130164318-yjnm9nz","updated":"20260130164318"},"Children":[{"Type":"NodeText","Data":"用户继承它来定义​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"实际要池化的对象"},{"Type":"NodeText","Data":"​："}]},{"ID":"20260130164318-pqjos3i","Type":"NodeParagraph","Properties":{"id":"20260130164318-pqjos3i","updated":"20260130164318"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"作用"},{"Type":"NodeText","Data":"​：定义\"什么东西被池化\"以及\"释放时做什么\"。"}]},{"ID":"20260130164318-fo5a9e7","Type":"NodeThematicBreak","Properties":{"id":"20260130164318-fo5a9e7","updated":"20260130164318"}},{"ID":"20260130164318-161akrm","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20260130164318-161akrm","updated":"20260130164318"},"Children":[{"Type":"NodeText","Data":"Object"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003c"}]},{"Type":"NodeText","Data":"T"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003e"}]},{"Type":"NodeText","Data":" — 内部包装器"}]},{"ID":"20260130164318-rm51gtj","Type":"NodeParagraph","Properties":{"id":"20260130164318-rm51gtj","updated":"20260130164318"},"Children":[{"Type":"NodeText","Data":"对象池内部用它来"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"包装和管理"},{"Type":"NodeText","Data":" ObjectBase："}]},{"ID":"20260130164318-6fr0va0","Type":"NodeParagraph","Properties":{"id":"20260130164318-6fr0va0","updated":"20260130164318"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"作用"},{"Type":"NodeText","Data":"​：追踪对象的​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"池化状态"},{"Type":"NodeText","Data":"​（引用计数、锁定、优先级）。"}]},{"ID":"20260130164318-7bpu5bb","Type":"NodeThematicBreak","Properties":{"id":"20260130164318-7bpu5bb","updated":"20260130164318"}},{"ID":"20260130164318-qkabi8y","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20260130164318-qkabi8y","updated":"20260130164318"},"Children":[{"Type":"NodeText","Data":"为什么要分开？"}]},{"ID":"20260130164318-y4m47uf","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|","id":"20260130164318-y4m47uf","updated":"20260130164318"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"设计目的"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"单一职责"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"ObjectBase 只管业务逻辑，Object"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003c"}]},{"Type":"NodeText","Data":"T"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003e"}]},{"Type":"NodeText","Data":" 只管池化状态"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"隐藏实现"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"用户不需要知道 SpawnCount、Locked 这些池内部概念"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"类型安全"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Object"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003c"}]},{"Type":"NodeText","Data":"T"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003e"}]},{"Type":"NodeText","Data":" 泛型包装，保证类型一致性"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"引用池复用"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Object"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003c"}]},{"Type":"NodeText","Data":"T"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003e"}]},{"Type":"NodeText","Data":" 本身也实现 IReference，可被 ReferencePool 回收"}]}]}]},{"ID":"20260130164318-vqpkj1h","Type":"NodeThematicBreak","Properties":{"id":"20260130164318-vqpkj1h","updated":"20260130164318"}},{"ID":"20260130164318-s6e8iyj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20260130164318-s6e8iyj","updated":"20260202181858"},"Children":[{"Type":"NodeText","Data":"简化理解"}]},{"ID":"20260130164318-7zp87a4","Type":"NodeParagraph","Properties":{"id":"20260130164318-7zp87a4","updated":"20260130164318"},"Children":[{"Type":"NodeText","Data":"这就是典型的​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"装饰器/代理模式"},{"Type":"NodeText","Data":"​——在不修改原对象的情况下，附加额外的管理逻辑。"}]},{"ID":"20260130121920-g6rkfu8","Type":"NodeParagraph","Properties":{"id":"20260130121920-g6rkfu8","updated":"20260130121941"},"Children":[{"Type":"NodeText","Data":"ObjectPoolManager管理各个ObjectPool"}]},{"ID":"20260130121941-6x9j78b","Type":"NodeParagraph","Properties":{"id":"20260130121941-6x9j78b","updated":"20260130122052"},"Children":[{"Type":"NodeText","Data":"ObjectPool中存放的是Object\u003cT\u003e"}]},{"ID":"20260130122103-lccx8ir","Type":"NodeParagraph","Properties":{"id":"20260130122103-lccx8ir","updated":"20260130122422"},"Children":[{"Type":"NodeText","Data":"要将各种类放入到对象池需要使用泛型，也就是ObjectPool\u003cT\u003e"}]},{"ID":"20260130122450-nz50p3p","Type":"NodeParagraph","Properties":{"id":"20260130122450-nz50p3p","updated":"20260130122536"},"Children":[{"Type":"NodeText","Data":"在对象池中为了方便管理，快速查找，使用统一的Object\u003cT\u003e管理"}]},{"ID":"20260202181208-0mormlm","Type":"NodeParagraph","Properties":{"id":"20260202181208-0mormlm","updated":"20260202181208"}},{"ID":"20260202181209-6ta1c19","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20260202181209-6ta1c19","updated":"20260202182024"},"Children":[{"Type":"NodeText","Data":"默认容量上限"}]},{"ID":"20260202181848-gg6t0vc","Type":"NodeParagraph","Properties":{"id":"20260202181848-gg6t0vc","updated":"20260202181928"},"Children":[{"Type":"NodeText","Data":"默认情况下对象池容量有最大上限，默认值为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"int.MaxValue"},{"Type":"NodeText","Data":"​，即 2,147,483,647 。该默认值在创建对象池时被使用，在运行时通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Capacity"},{"Type":"NodeText","Data":"​ 属性修改容量，设置时会触发释放逻辑以使对象数不超过新容量 ObjectPoolManager.ObjectPool.cs:121-141 。"}]},{"ID":"20260202181848-wdfgoj2","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20260202181848-wdfgoj2","updated":"20260202182024"},"Children":[{"Type":"NodeText","Data":"Notes"}]},{"ID":"20260202181848-80lmej1","Type":"NodeList","ListData":{},"Properties":{"id":"20260202181848-80lmej1","updated":"20260202181848"},"Children":[{"ID":"20260202181848-r5w587r","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20260202181848-r5w587r","updated":"20260202181848"},"Children":[{"ID":"20260202181848-r685qqa","Type":"NodeParagraph","Properties":{"id":"20260202181848-r685qqa","updated":"20260202181848"},"Children":[{"Type":"NodeText","Data":"对象池容量为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"int.MaxValue"},{"Type":"NodeText","Data":"​ 意味着在默认配置下几乎不会因容量上限触发释放，除非显式设置较小容量或依赖过期时间与自动释放策略 ObjectPoolManager.ObjectPool.cs:202-205 。"}]}]},{"ID":"20260202181848-f1mzpkg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20260202181848-f1mzpkg","updated":"20260202181848"},"Children":[{"ID":"20260202181848-8e0xd3z","Type":"NodeParagraph","Properties":{"id":"20260202181848-8e0xd3z","updated":"20260202181848"},"Children":[{"Type":"NodeText","Data":"若需限制内存占用，建议在创建池时指定合理的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"capacity"},{"Type":"NodeText","Data":"​ 参数，或后续动态调整 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Capacity"},{"Type":"NodeText","Data":"​ 属性"}]}]}]},{"ID":"20260202181956-7ovce2v","Type":"NodeParagraph","Properties":{"id":"20260202181956-7ovce2v","updated":"20260202181956"}},{"ID":"20260202181957-ziwv9qo","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20260202181957-ziwv9qo","updated":"20260202182233"},"Children":[{"Type":"NodeText","Data":"生成上限"}]},{"ID":"20260202182104-n53lov9","Type":"NodeParagraph","Properties":{"id":"20260202182104-n53lov9","updated":"20260202182104"},"Children":[{"Type":"NodeText","Data":"假设单生成对象池注册了10个Item，当申请第11个且前10个都正在被使用，会发生什么？"}]},{"ID":"20260202182104-r0l6qle","Type":"NodeParagraph","Properties":{"id":"20260202182104-r0l6qle","updated":"20260202182131"},"Children":[{"Type":"NodeText","Data":"会返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"null"},{"Type":"NodeText","Data":"​。在单生成对象池中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Spawn"},{"Type":"NodeText","Data":"​ 方法会遍历池中对象，仅当对象未被使用（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"!IsInUse"},{"Type":"NodeText","Data":"​）时才返回该对象 。若所有10个对象都在使用中，则没有可用的对象，方法最终返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"null"},{"Type":"NodeText","Data":"​ 。"}]},{"ID":"20260202182104-2wwnw2m","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20260202182104-2wwnw2m","updated":"20260202182233"},"Children":[{"Type":"NodeText","Data":"Notes"}]},{"ID":"20260202182104-l3v0yb4","Type":"NodeList","ListData":{},"Properties":{"id":"20260202182104-l3v0yb4","updated":"20260202182149"},"Children":[{"ID":"20260202182104-hdjxh3n","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20260202182104-hdjxh3n","updated":"20260202182149"},"Children":[{"ID":"20260202182104-l4arbva","Type":"NodeParagraph","Properties":{"id":"20260202182104-l4arbva","updated":"20260202182149"},"Children":[{"Type":"NodeText","Data":"单生成对象池的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AllowMultiSpawn"},{"Type":"NodeText","Data":"​ 为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​，因此即使对象在池中，只要 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"IsInUse"},{"Type":"NodeText","Data":"​ 为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"true"},{"Type":"NodeText","Data":"​ 就不会被重复获取 。"}]}]},{"ID":"20260202182104-kx4xz3q","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20260202182104-kx4xz3q","updated":"20260202182104"},"Children":[{"ID":"20260202182104-omdmlks","Type":"NodeParagraph","Properties":{"id":"20260202182104-omdmlks","updated":"20260202182104"},"Children":[{"Type":"NodeText","Data":"若需要避免返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"null"},{"Type":"NodeText","Data":"​，可在调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Spawn"},{"Type":"NodeText","Data":"​ 前用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CanSpawn"},{"Type":"NodeText","Data":"​ 检查是否有可用对象"}]}]}]},{"ID":"20260202182213-y12u6jv","Type":"NodeParagraph","Properties":{"id":"20260202182213-y12u6jv","updated":"20260202182213"}},{"ID":"20260202182206-l8lxf17","Type":"NodeParagraph","Properties":{"id":"20260202182206-l8lxf17","updated":"20260202182233"},"Children":[{"Type":"NodeText","Data":"对象池不会自行实例化 Item，只能使用通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Register"},{"Type":"NodeText","Data":"​ 事先注册到池中的对象。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Spawn"},{"Type":"NodeText","Data":"​ 方法仅从已注册的对象中查找并返回未被使用的对象，若没有可用对象则返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"null"},{"Type":"NodeText","Data":"​，而不会创建新实例 。"}]},{"ID":"20260202182206-424tyz3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20260202182206-424tyz3","updated":"20260203194529"},"Children":[{"Type":"NodeText","Data":"Notes"}]},{"ID":"20260202182206-b915d2o","Type":"NodeList","ListData":{},"Properties":{"id":"20260202182206-b915d2o","updated":"20260202182206"},"Children":[{"ID":"20260202182206-z02aj8h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20260202182206-z02aj8h","updated":"20260202182206"},"Children":[{"ID":"20260202182206-9avjsti","Type":"NodeParagraph","Properties":{"id":"20260202182206-9avjsti","updated":"20260202182257"},"Children":[{"Type":"NodeText","Data":"对象池的设计目标是复用对象以减少 GC 压力，因此要求显式 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Register"},{"Type":"NodeText","Data":"​ 对象，由调用方控制对象的生命周期与创建逻辑  。"}]}]},{"ID":"20260202182206-uy11568","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20260202182206-uy11568","updated":"20260202182206"},"Children":[{"ID":"20260202182206-pjhaj5m","Type":"NodeParagraph","Properties":{"id":"20260202182206-pjhaj5m","updated":"20260202182206"},"Children":[{"Type":"NodeText","Data":"若需要动态扩容，通常由上层系统（如 Entity/UI）在检测到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Spawn"},{"Type":"NodeText","Data":"​ 返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"null"},{"Type":"NodeText","Data":"​ 时自行创建新对象并 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Register"},{"Type":"NodeText","Data":"​ 到池中，而非对象池自动创建。"}]}]}]},{"ID":"20260203194526-xdpo14u","Type":"NodeParagraph","Properties":{"id":"20260203194526-xdpo14u","updated":"20260203194526"}},{"ID":"20260203194527-nzw2dpj","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20260203194527-nzw2dpj","updated":"20260203194625"},"Children":[{"Type":"NodeText","Data":"Priority优先级"}]},{"ID":"20260203194535-y1d6fuq","Type":"NodeParagraph","Properties":{"id":"20260203194535-y1d6fuq","updated":"20260203194625"},"Children":[{"Type":"NodeText","Data":"Priority值越小优先级越高，在释放时先释放优先级低的（也就是Priority值大的）"}]}]}