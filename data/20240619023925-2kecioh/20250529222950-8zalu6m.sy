{"ID":"20250529222950-8zalu6m","Spec":"1","Type":"NodeDocument","Properties":{"id":"20250529222950-8zalu6m","title":"C#中a.GetType()和typeof(T)是否等价","type":"doc","updated":"20250529223020"},"Children":[{"ID":"20250529222954-sokaxvt","Type":"NodeParagraph","Properties":{"id":"20250529222954-sokaxvt","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"在 C# 中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"typeof(a)"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a.GetType()"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"通常不等价"},{"Type":"NodeText","Data":"，它们的行为和适用场景有本质区别："}]},{"ID":"20250529222954-tr1zdsx","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250529222954-tr1zdsx","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"1. 核心区别"}]},{"ID":"20250529222954-je8w2hn","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20250529222954-je8w2hn","updated":"20250529222954"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"对比项"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"typeof(a)"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"a.GetType()"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"参数类型"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"必须是"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"类型名"},{"Type":"NodeText","Data":"（如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"int"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"string"},{"Type":"NodeText","Data":"​）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"必须是"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"对象实例"},{"Type":"NodeText","Data":"（变量）"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"编译时解析"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"✅ 编译时确定类型"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"❌ 运行时确定类型"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"支持 null"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"✅ 可以用于任何类型（包括可空类型）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"❌ 如果 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a"},{"Type":"NodeText","Data":"​ 为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"null"},{"Type":"NodeText","Data":"​，抛出 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NullReferenceException"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"基类 / 接口场景"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"返回声明类型"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"返回实际运行时类型"}]}]}]},{"ID":"20250529222954-47jn47d","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250529222954-47jn47d","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"2. 示例说明"}]},{"ID":"20250529222954-lmi0jpk","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20250529222954-lmi0jpk","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"(1) 声明类型与运行时类型一致"}]},{"ID":"20250529222954-sjbvv8p","Type":"NodeParagraph","Properties":{"id":"20250529222954-sjbvv8p","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"csharp"}]},{"ID":"20250529222954-2lw6rxw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250529222954-2lw6rxw","updated":"20250529222954"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"string text = \"hello\";\nConsole.WriteLine(typeof(string) == text.GetType());  // true\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250529222954-dgzkzjt","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20250529222954-dgzkzjt","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"(2) 声明类型与运行时类型不一致（多态）"}]},{"ID":"20250529222954-1nrmthq","Type":"NodeParagraph","Properties":{"id":"20250529222954-1nrmthq","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"csharp"}]},{"ID":"20250529222954-vplpaz7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250529222954-vplpaz7","updated":"20250529222954"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"Animal animal = new Dog();  // Animal是基类，Dog是子类\nConsole.WriteLine(typeof(Animal) == animal.GetType());  // false，animal.GetType()返回Dog\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250529222954-461bs9b","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20250529222954-461bs9b","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"(3) 基类引用子类实例"}]},{"ID":"20250529222954-u5nmh9d","Type":"NodeParagraph","Properties":{"id":"20250529222954-u5nmh9d","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"csharp"}]},{"ID":"20250529222954-bk91aq3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250529222954-bk91aq3","updated":"20250529222954"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"List\u003cstring\u003e list = new List\u003cstring\u003e();\nIEnumerable\u003cstring\u003e enumerable = list;\nConsole.WriteLine(typeof(IEnumerable\u003cstring\u003e) == enumerable.GetType());  // false\nConsole.WriteLine(typeof(List\u003cstring\u003e) == list.GetType());  // true\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250529222954-s2v3vb1","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20250529222954-s2v3vb1","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"(4) null 值的情况"}]},{"ID":"20250529222954-l76kc7e","Type":"NodeParagraph","Properties":{"id":"20250529222954-l76kc7e","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"csharp"}]},{"ID":"20250529222954-s6blwi3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250529222954-s6blwi3","updated":"20250529222954"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"string text = null;\nConsole.WriteLine(typeof(string));  // 正常返回System.String\n// Console.WriteLine(text.GetType());  // 抛出NullReferenceException\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250529222954-z17zp49","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250529222954-z17zp49","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"3. 性能差异"}]},{"ID":"20250529222954-qetdhjt","Type":"NodeList","ListData":{},"Properties":{"id":"20250529222954-qetdhjt","updated":"20250529222954"},"Children":[{"ID":"20250529222954-xkt0n9n","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-xkt0n9n","updated":"20250529222954"},"Children":[{"ID":"20250529222954-5nuopxe","Type":"NodeParagraph","Properties":{"id":"20250529222954-5nuopxe","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"typeof(T)"},{"Type":"NodeText","Data":"：编译时硬编码为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"System.Type"},{"Type":"NodeText","Data":"​ 对象，无运行时开销。"}]}]},{"ID":"20250529222954-t57aajs","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-t57aajs","updated":"20250529222954"},"Children":[{"ID":"20250529222954-sae9o81","Type":"NodeParagraph","Properties":{"id":"20250529222954-sae9o81","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"a.GetType()"},{"Type":"NodeText","Data":"：需要在运行时通过对象的类型元数据获取，有轻微性能开销。"}]}]}]},{"ID":"20250529222954-4d8ge92","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250529222954-4d8ge92","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"4. 常见混淆场景"}]},{"ID":"20250529222954-e0e24dt","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20250529222954-e0e24dt","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"(1) 泛型方法中的类型判断"}]},{"ID":"20250529222954-0ev2q61","Type":"NodeParagraph","Properties":{"id":"20250529222954-0ev2q61","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"csharp"}]},{"ID":"20250529222954-n37b85y","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250529222954-n37b85y","updated":"20250529222954"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"public void PrintType\u003cT\u003e(T obj)\n{\n    Console.WriteLine(typeof(T));  // 返回泛型参数T的类型\n    Console.WriteLine(obj.GetType());  // 返回obj的实际运行时类型\n}\n\n// 调用\nPrintType(new Dog());  // typeof(T)是Animal，obj.GetType()是Dog\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250529222954-0bb3mxz","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20250529222954-0bb3mxz","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"(2) 反射中的类型比较"}]},{"ID":"20250529222954-escva7s","Type":"NodeParagraph","Properties":{"id":"20250529222954-escva7s","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"csharp"}]},{"ID":"20250529222954-capasxo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250529222954-capasxo","updated":"20250529222954"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"object num = 42;\nbool isInt1 = typeof(int) == num.GetType();  // true\nbool isInt2 = num is int;  // true（使用is运算符更简洁）\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250529222954-8wjgklh","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250529222954-8wjgklh","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"5. 适用场景"}]},{"ID":"20250529222954-n4d87vv","Type":"NodeList","ListData":{},"Properties":{"id":"20250529222954-n4d87vv","updated":"20250529222954"},"Children":[{"ID":"20250529222954-4hgb20i","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-4hgb20i","updated":"20250529222954"},"Children":[{"ID":"20250529222954-wn1smzy","Type":"NodeParagraph","Properties":{"id":"20250529222954-wn1smzy","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"typeof(T)"},{"Type":"NodeText","Data":"："}]},{"ID":"20250529222954-3dqym2a","Type":"NodeList","ListData":{},"Properties":{"id":"20250529222954-3dqym2a","updated":"20250529222954"},"Children":[{"ID":"20250529222954-qvp5jcj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-qvp5jcj","updated":"20250529222954"},"Children":[{"ID":"20250529222954-em6edgb","Type":"NodeParagraph","Properties":{"id":"20250529222954-em6edgb","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"获取已知类型的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Type"},{"Type":"NodeText","Data":"​ 对象（如 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"typeof(int)"},{"Type":"NodeText","Data":"​）。"}]}]},{"ID":"20250529222954-fyw7484","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-fyw7484","updated":"20250529222954"},"Children":[{"ID":"20250529222954-d42dzyd","Type":"NodeParagraph","Properties":{"id":"20250529222954-d42dzyd","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"在编译时进行类型检查（如泛型约束 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"where T : SomeBaseClass"},{"Type":"NodeText","Data":"​）。"}]}]}]}]},{"ID":"20250529222954-llmqgti","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-llmqgti","updated":"20250529222954"},"Children":[{"ID":"20250529222954-yznvnaj","Type":"NodeParagraph","Properties":{"id":"20250529222954-yznvnaj","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"a.GetType()"},{"Type":"NodeText","Data":"："}]},{"ID":"20250529222954-yf15fr0","Type":"NodeList","ListData":{},"Properties":{"id":"20250529222954-yf15fr0","updated":"20250529222954"},"Children":[{"ID":"20250529222954-nq7tow6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-nq7tow6","updated":"20250529222954"},"Children":[{"ID":"20250529222954-b7s45lu","Type":"NodeParagraph","Properties":{"id":"20250529222954-b7s45lu","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"获取对象的实际运行时类型（用于多态场景）。"}]}]},{"ID":"20250529222954-mewv2ml","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-mewv2ml","updated":"20250529222954"},"Children":[{"ID":"20250529222954-3ws89nk","Type":"NodeParagraph","Properties":{"id":"20250529222954-3ws89nk","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"在反射中动态分析对象类型。"}]}]}]}]}]},{"ID":"20250529222954-i64bjoo","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250529222954-i64bjoo","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"总结"}]},{"ID":"20250529222954-gswb0pm","Type":"NodeList","ListData":{},"Properties":{"id":"20250529222954-gswb0pm","updated":"20250529222954"},"Children":[{"ID":"20250529222954-dn0fu6c","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-dn0fu6c","updated":"20250529222954"},"Children":[{"ID":"20250529222954-x0ibb9p","Type":"NodeParagraph","Properties":{"id":"20250529222954-x0ibb9p","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"不等价"},{"Type":"NodeText","Data":"："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"typeof(a)"},{"Type":"NodeText","Data":"​ 返回声明类型，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a.GetType()"},{"Type":"NodeText","Data":"​ 返回运行时类型。"}]}]},{"ID":"20250529222954-0qukghq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-0qukghq","updated":"20250529222954"},"Children":[{"ID":"20250529222954-w6n879v","Type":"NodeParagraph","Properties":{"id":"20250529222954-w6n879v","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意 null"},{"Type":"NodeText","Data":"："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a.GetType()"},{"Type":"NodeText","Data":"​ 不能用于 null 对象。"}]}]},{"ID":"20250529222954-5f7jdbt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250529222954-5f7jdbt","updated":"20250529222954"},"Children":[{"ID":"20250529222954-9jn7a01","Type":"NodeParagraph","Properties":{"id":"20250529222954-9jn7a01","updated":"20250529222954"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"性能优先"},{"Type":"NodeText","Data":"：能用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"typeof"},{"Type":"NodeText","Data":"​ 时尽量避免 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"GetType()"},{"Type":"NodeText","Data":"​。"}]}]}]},{"ID":"20250529222954-rihy0z8","Type":"NodeParagraph","Properties":{"id":"20250529222954-rihy0z8","updated":"20250529222954"},"Children":[{"Type":"NodeText","Data":"选择哪种方式取决于你需要的是"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"声明类型"},{"Type":"NodeText","Data":"还是"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"实际运行时类型"},{"Type":"NodeText","Data":"。"}]}]}