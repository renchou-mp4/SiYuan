{"ID":"20230713203829-or0qlaq","Spec":"2","Type":"NodeDocument","Properties":{"id":"20230713203829-or0qlaq","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20230713203829-juaqf91\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20230713203829-2m1qdvl\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230720185713-jycag1v\u0026quot;,\u0026quot;scrollTop\u0026quot;:200,\u0026quot;focusId\u0026quot;:\u0026quot;20230714144529-058iyuo\u0026quot;,\u0026quot;focusStart\u0026quot;:138,\u0026quot;focusEnd\u0026quot;:138\u0026#125;","title":"Unity PrefabUtility","type":"doc","updated":"20231115180309"},"Children":[{"ID":"20230713203829-6kvvoax","Type":"NodeParagraph","Properties":{"id":"20230713203829-6kvvoax","updated":"20230713214107"},"Children":[{"Type":"NodeText","Data":"对Prefab进行操作的API，可以通过代码进行与面板中一样的操纵，包括添加删除修改组件，添加删除修改预制体等等。对大量重复性的操作Prefab的工作可以使用此API编写工具。"}]},{"ID":"20230713214144-oz0wlau","Type":"NodeParagraph","Properties":{"id":"20230713214144-oz0wlau"}},{"ID":"20230713214148-m761u8d","Type":"NodeParagraph","Properties":{"id":"20230713214148-m761u8d"}},{"ID":"20230713213408-ewnlrb3","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230713213408-ewnlrb3","updated":"20230713214140"},"Children":[{"Type":"NodeText","Data":"需求"}]},{"ID":"20230713214155-p77ejwp","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230713214155-p77ejwp","updated":"20230713214209"},"Children":[{"Type":"NodeText","Data":"1、给大量预制体添加Animator组件"}]},{"ID":"20230713213408-zelxbyg","Type":"NodeParagraph","Properties":{"id":"20230713213408-zelxbyg","updated":"20230713214411"},"Children":[{"Type":"NodeText","Data":"背景：大量弹窗预制体需要添加通用的动画。"}]},{"ID":"20230713213408-16cih3w","Type":"NodeParagraph","Properties":{"id":"20230713213408-16cih3w","updated":"20230713214416"},"Children":[{"Type":"NodeText","Data":"思路："}]},{"ID":"20230713214417-i8x8lbp","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230713214417-i8x8lbp","updated":"20230713214420"},"Children":[{"ID":"20230713214420-dwbj3s2","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230713214420-dwbj3s2","updated":"20230713214420"},"Children":[{"ID":"20230713214420-tsn26f8","Type":"NodeParagraph","Properties":{"id":"20230713214420-tsn26f8","updated":"20230713215127"},"Children":[{"Type":"NodeText","Data":"首先筛选出符合条件的预制体。\n① 匹配路径、后缀。\n② 匹配没有添加Animator或Animation的。\n③ 匹配弹窗都有的元素，如关闭按钮，可以通过是否包含关闭图标来筛选。\n④ 匹配父级代码，一般弹窗的脚本都是继承自某个父类，可以通过是否继承自父级脚本判断。"}]}]},{"ID":"20230713215136-vehu0c6","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20230713215136-vehu0c6"},"Children":[{"ID":"20230713215136-uimn42p","Type":"NodeParagraph","Properties":{"id":"20230713215136-uimn42p","updated":"20230713215216"},"Children":[{"Type":"NodeText","Data":"使用PrefabUtility的API给预制体添加组件。"}]}]}]},{"ID":"20230713215218-vwj5ioe","Type":"NodeParagraph","Properties":{"id":"20230713215218-vwj5ioe","updated":"20230714112402"},"Children":[{"Type":"NodeText","Data":"坑："}]},{"ID":"20230714112404-zy4dtxv","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230714112404-zy4dtxv","updated":"20230714112408"},"Children":[{"ID":"20230714112408-n2wxbx0","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230714112408-n2wxbx0","updated":"20230714112408"},"Children":[{"ID":"20230714112408-kmyan3t","Type":"NodeParagraph","Properties":{"id":"20230714112408-kmyan3t","updated":"20230714144528"},"Children":[{"Type":"NodeText","Data":"Animator表示的是组件，Animator组件上的控制器为RuntimeAnimatorController。加载AB包中的Animator，实际上要转为RuntimeAnimatorController类。"}]}]},{"ID":"20230714144529-ga4ikc1","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20230714144529-ga4ikc1"},"Children":[{"ID":"20230714144529-l4058zl","Type":"NodeParagraph","Properties":{"id":"20230714144529-l4058zl","updated":"20230714154139"},"Children":[{"Type":"NodeText","Data":"使用ApplyPrefabInstance时要先使用InstantiatePrefab将Prefab创建出来。使用InstantiatePrefab创建出来的实例与Prefab关联（在面板上就是蓝色的），通过它才能修改Prefab，普通的Instantiate不可以，会报错。"}]}]}]},{"ID":"20230714154235-3n6ym2t","Type":"NodeParagraph","Properties":{"id":"20230714154235-3n6ym2t","updated":"20230714154241"},"Children":[{"Type":"NodeText","Data":"其他："}]},{"ID":"20230714154242-qxkiohh","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230714154242-qxkiohh","updated":"20230714154245"},"Children":[{"ID":"20230714154245-4v3nk73","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230714154245-4v3nk73","updated":"20230714154245"},"Children":[{"ID":"20230714154245-u45242f","Type":"NodeParagraph","Properties":{"id":"20230714154245-u45242f","updated":"20230714161313"},"Children":[{"Type":"NodeText","Data":"使用图片资源来查找预制体\n① 需要有这个图片的GUID。\n② 将预制体使用二进制流读取，再转为string，即可通过查找图片GUID来判断。"}]}]},{"ID":"20230714161314-i6daah2","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20230714161314-i6daah2"},"Children":[{"ID":"20230714161314-o6zftud","Type":"NodeParagraph","Properties":{"id":"20230714161314-o6zftud","updated":"20230714172428"},"Children":[{"Type":"NodeText","Data":"将预制体打开后需要判断是否包含Animation或Animator字段，但是会有m_Animation字段干扰。需要使用正则匹配。"}]}]}]},{"ID":"20230714172433-jj59beu","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230714172433-jj59beu","updated":"20230720183454"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YyM="},{"Type":"NodeCodeBlockCode","Data":"public class PopupAddAnimTool : MonoBehaviour\n{\n    [MenuItem(\"Tools/UI/AddAnim\")]\n    public static void AddAnim()\n    {\n        //获取所有资源路径\n        string[] allAssetPath = AssetDatabase.GetAllAssetPaths();\n        //UI Prefab，且名字不带有Dialog、RogueLike\n        List\u003cstring\u003e prefabAssetPath = new List\u003cstring\u003e();\n        //没有Animation或Animator\n        List\u003cstring\u003e noAnimPrefabPath = new List\u003cstring\u003e();\n\t//目标Prefab\n        List\u003cstring\u003e targetPrefabPath = new List\u003cstring\u003e();\n\t//目标Prefab的实例化\n        List\u003cGameObject\u003e targetPrefabs = new List\u003cGameObject\u003e();\n\n        //根据路径筛选prefab\n        foreach (string assetPath in allAssetPath)\n        {\n            if (assetPath.Contains(\"Prefabs/UI\")\n                \u0026\u0026 assetPath.EndsWith(\".prefab\")\n                \u0026\u0026 !assetPath.Contains(\"Dialog\")\n                \u0026\u0026 !assetPath.Contains(\"RogueLike\")\n                )\n            {\n                prefabAssetPath.Add(assetPath);\n            }\n        }\n\n        //筛选没有Animation和Animator的\n        foreach (string assetPath in prefabAssetPath)\n        {\n\t    //使用二进制流读取Prefab，然后转为string\n            FileStream fileStream = new FileStream(assetPath, FileMode.Open);\n            byte[] buffer = new byte[fileStream.Length];\n            fileStream.Read(buffer, 0, (int)fileStream.Length);\n            string context = Encoding.Default.GetString(buffer);\n\n\t    //正则匹配\n            if (Regex.IsMatch(context, \"(?\u003c!m_)Animation\") || Regex.IsMatch(context, \"(?\u003c!m_)Animator\"))\n                continue;\n\t    //正则匹配图片uid\n            if (!Regex.IsMatch(context, \"63c93f73e04296540bf36df278e7c9ce\"))\n                continue;\n\n            noAnimPrefabPath.Add(assetPath);\n        }\n\n        //筛选目标prefab\n        GameObject go = null;\n        GameObject parent = GameObject.Find(\"Popup\");\n        RuntimeAnimatorController controller = AssetDatabase.LoadAssetAtPath\u003cRuntimeAnimatorController\u003e(\"Assets/Bundles/Animations/Common/CommonPopupAnimator.controller\");\n\n        foreach (string assetPath in noAnimPrefabPath)\n        {\n            go = AssetDatabase.LoadAssetAtPath\u003cGameObject\u003e(assetPath);\n            if (go.GetComponent\u003cUIWindowPopupBase\u003e() != null)\n            {\n                targetPrefabs.Add(go);\n                targetPrefabPath.Add(assetPath);\n\n\t\t//使用PrefabUtility.InstantiatePrefab创建预制体，之后才可以Apply\n                GameObject tempGO = (GameObject)PrefabUtility.InstantiatePrefab(go);\n                Animator anim = tempGO.AddComponent\u003cAnimator\u003e();\n\t\t//Animator上的Controller值是runtimeAnimatorController类\n                anim.runtimeAnimatorController = controller;\n                PrefabUtility.ApplyPrefabInstance(tempGO, InteractionMode.AutomatedAction);\n            }\n        }\n\n        Debug.Log(\"结束\");\n    }\n}\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230714172434-ksm7h7s","Type":"NodeParagraph","Properties":{"id":"20230714172434-ksm7h7s"}},{"ID":"20230713213408-ssb2dke","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230713213408-ssb2dke","updated":"20230713213422"},"Children":[{"Type":"NodeText","Data":"参考文档"}]},{"ID":"20230713213424-y8qvkjx","Type":"NodeParagraph","Properties":{"id":"20230713213424-y8qvkjx","updated":"20230713213425"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://docs.unity.cn/cn/current/ScriptReference/PrefabUtility.html","TextMarkTextContent":"UnityEditor.PrefabUtility - Unity 脚本 API"}]},{"ID":"20230713213426-dlkyvwc","Type":"NodeParagraph","Properties":{"id":"20230713213426-dlkyvwc","updated":"20230713213934"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://blog.csdn.net/Htlas/article/details/83182957","TextMarkTextContent":"(1条消息) UnityEditor——利用Prefab的Refrences引用来查找预制体的组件_unity获取预制体的组件_Htlas的博客-CSDN博客"}]},{"ID":"20230713215247-evpijs7","Type":"NodeParagraph","Properties":{"id":"20230713215247-evpijs7","updated":"20230720185713"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://blog.csdn.net/qq_37421018/article/details/98172662","TextMarkTextContent":"(2条消息) Unity 关于GUID的一些实用例子_unity guid_好身亡的博客-CSDN博客"}]},{"ID":"20230720185713-u7e7j1x","Type":"NodeParagraph","Properties":{"id":"20230720185713-u7e7j1x"}}]}