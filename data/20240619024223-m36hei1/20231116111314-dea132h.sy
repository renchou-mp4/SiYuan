{"ID":"20231116111314-dea132h","Spec":"2","Type":"NodeDocument","Properties":{"id":"20231116111314-dea132h","title":"Unity 图集","type":"doc","updated":"20231214105301"},"Children":[{"ID":"20231116111322-zisgefb","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231116111322-zisgefb","updated":"20231116140809"},"Children":[{"Type":"NodeText","Data":"图集的目的"}]},{"ID":"20231116111314-hf1kgl7","Type":"NodeParagraph","Properties":{"id":"20231116111314-hf1kgl7","updated":"20231116143529"},"Children":[{"Type":"NodeText","Data":"简单来说有两个目的："}]},{"ID":"20231116143529-7izi7jb","Type":"NodeParagraph","Properties":{"id":"20231116143529-7izi7jb","updated":"20231116143536"},"Children":[{"Type":"NodeText","Data":"1、减少Draw Call"}]},{"ID":"20231116143537-q4abgnl","Type":"NodeParagraph","Properties":{"id":"20231116143537-q4abgnl","updated":"20231116143553"},"Children":[{"Type":"NodeText","Data":"2、减少内存占用"}]},{"ID":"20231116143555-u5gpsx7","Type":"NodeParagraph","Properties":{"id":"20231116143555-u5gpsx7"}},{"ID":"20231116143559-qcc1k3j","Type":"NodeParagraph","Properties":{"id":"20231116143559-qcc1k3j","updated":"20231116174132"},"Children":[{"Type":"NodeText","Data":"当我们在使用Sprite或其他图形的时候，在场景中每添加一个，Unity就会调用一次Draw Call来绘制一次。如果场景中的图形很多，那么就会产生大量的Draw Call，会严重影响性能。图集是一种将多个纹理合并为一个组合纹理的资源。Unity可以调用这个组合纹理来同时绘制多个图形，这样就可以节省性能开销。此外，图集API还可以控制如何在项目运行时加载图集。"}]},{"ID":"20231116174820-4smq3uh","Type":"NodeParagraph","Properties":{"id":"20231116174820-4smq3uh"}},{"ID":"20231116175444-umvzloo","Type":"NodeParagraph","Properties":{"id":"20231116175444-umvzloo","updated":"20231117153515"},"Children":[{"Type":"NodeText","Data":"在OpenGL ES中，每张贴图都需要设置成2的次方大小才可以使用。因此Unity会将所有不是2的次方大小的贴图扩展成2的次方大小。例如500"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeBackslashContent","Data":"*"}]},{"Type":"NodeText","Data":"500大小的图片，会被扩展成512"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeBackslashContent","Data":"*"}]},{"Type":"NodeText","Data":"512，那么就会有一部分空间被浪费。但如果打包成图集，Unity会自动将一些较小的贴图放到空闲的部分，提高利用率，这就节省的内存占用。所以"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color12);"},"TextMarkType":"text","TextMarkTextContent":"图集占用的内存大小只与图集的压缩格式和长宽有关，与贴图的数量无关。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color12);\"}"},{"Type":"NodeText","Data":"（512"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeBackslashContent","Data":"*"}]},{"Type":"NodeText","Data":"512中可以放1张贴图，也可以放多张贴图，但占用的内存大小不变）"}]},{"ID":"20231117144900-hvk6y4d","Type":"NodeParagraph","Properties":{"id":"20231117144900-hvk6y4d"}},{"ID":"20231214105111-gt67wmp","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231214105111-gt67wmp","updated":"20231214105119"},"Children":[{"Type":"NodeText","Data":"图集的属性"}]},{"ID":"20231214105111-j7lyo7m","Type":"NodeParagraph","Properties":{"id":"20231214105111-j7lyo7m","updated":"20231214105138"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Include In Build"},{"Type":"NodeText","Data":"​属性是用来选择是否在构建的时候包含该图集。"}]},{"ID":"20231214105141-j3jyx3p","Type":"NodeParagraph","Properties":{"id":"20231214105141-j3jyx3p","updated":"20231214105207"},"Children":[{"Type":"NodeText","Data":"例如有一个图集有多个变体集，那么在为不同性能的硬件构建时，会选择这些变体集中的某一个，那么就给选择的变体集勾选Include In Build，不勾选的就不会进入构建中。如果使用了AB包，那么勾选了"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Include In Build"},{"Type":"NodeText","Data":"​的图集会被打进AB包，没有勾选的则不会。"}]},{"ID":"20231214105301-pbdccaq","Type":"NodeParagraph","Properties":{"id":"20231214105301-pbdccaq","updated":"20231214105301"}},{"ID":"20231117154857-bs6apui","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231117154857-bs6apui","updated":"20231117155240"},"Children":[{"Type":"NodeText","Data":"图集的Group"}]},{"ID":"20231117154857-al4up8h","Type":"NodeParagraph","Properties":{"id":"20231117154857-al4up8h","updated":"20231117160006"},"Children":[{"Type":"NodeText","Data":"图集有时候会产生多个Group，可以在Inspector面板的下方看到。每多一个Group就会多产生一次Draw Call。"}]},{"ID":"20231117155723-ozhlxfq","Type":"NodeParagraph","Properties":{"id":"20231117155723-ozhlxfq","updated":"20231117155802"},"Children":[{"Type":"NodeText","Data":"产生Group的原因："}]},{"ID":"20231117155802-5octiwe","Type":"NodeParagraph","Properties":{"id":"20231117155802-5octiwe","updated":"20231117155825"},"Children":[{"Type":"NodeText","Data":"1、纹理的格式不同"}]},{"ID":"20231117155825-ulzsgdl","Type":"NodeParagraph","Properties":{"id":"20231117155825-ulzsgdl","updated":"20231117155854"},"Children":[{"Type":"NodeText","Data":"2、纹理的数量太多，一个Group放不下"}]},{"ID":"20231117155942-t6ch6ae","Type":"NodeParagraph","Properties":{"id":"20231117155942-t6ch6ae","updated":"20231117160023"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231117155941-s4nvs1e.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231117160023-ghc7rjz.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231117160028-cl3yean","Type":"NodeParagraph","Properties":{"id":"20231117160028-cl3yean","updated":"20231117160042"},"Children":[{"Type":"NodeText","Data":"如上，同一个图集被分为了两个Group。"}]},{"ID":"20231120092512-tdn9q5b","Type":"NodeParagraph","Properties":{"id":"20231120092512-tdn9q5b"}},{"ID":"20231120092512-ivo1aqv","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231120092512-ivo1aqv","updated":"20231120100346"},"Children":[{"Type":"NodeText","Data":"图集的渲染的几种情况"}]},{"ID":"20231120092523-gge7x1l","Type":"NodeParagraph","Properties":{"id":"20231120092523-gge7x1l","updated":"20231120092644"},"Children":[{"Type":"NodeTextMark","TextMarkType":"b","TextMarkTextContent":"1、"},{"Type":"NodeText","Data":"三张图片不打包图集也不相交"}]},{"ID":"20231120092600-qa3z9g2","Type":"NodeParagraph","Properties":{"id":"20231120092600-qa3z9g2","updated":"20231120092610"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic1.zhimg.com/80/v2-4f15c13a3f55d77ef316c11819d818c8_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-2tbnvfa","Type":"NodeParagraph","Properties":{"id":"20231120092600-2tbnvfa","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"结果：DrawCall为3。"}]},{"ID":"20231120092623-jf6qp23","Type":"NodeParagraph","Properties":{"id":"20231120092623-jf6qp23"}},{"ID":"20231120092600-ecig37s","Type":"NodeParagraph","Properties":{"id":"20231120092600-ecig37s","updated":"20231120092649"},"Children":[{"Type":"NodeText","Data":"2、三张图片不打包图集但是相互相交"}]},{"ID":"20231120092600-3v6dso9","Type":"NodeParagraph","Properties":{"id":"20231120092600-3v6dso9","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic3.zhimg.com/80/v2-3de907fabd3b73bd2489ccf80c749f42_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-w7qm6rf","Type":"NodeParagraph","Properties":{"id":"20231120092600-w7qm6rf","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"结果：DrawCall为3，和第一种情况相同。"}]},{"ID":"20231120092656-nkpne2n","Type":"NodeParagraph","Properties":{"id":"20231120092656-nkpne2n"}},{"ID":"20231120092600-fgcsvnr","Type":"NodeParagraph","Properties":{"id":"20231120092600-fgcsvnr","updated":"20231120092701"},"Children":[{"Type":"NodeText","Data":"3、三张图片打成一个图集，但是有2个Group，且三张图互不相交"}]},{"ID":"20231120092600-62tt5pm","Type":"NodeParagraph","Properties":{"id":"20231120092600-62tt5pm","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic3.zhimg.com/80/v2-678f6e8837b4bd838352379fa9444396_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-iotg2fa","Type":"NodeParagraph","Properties":{"id":"20231120092600-iotg2fa","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic3.zhimg.com/80/v2-01b61c9f811c4c3c84099d0c4c0ce2fe_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-fg8rfk6","Type":"NodeParagraph","Properties":{"id":"20231120092600-fg8rfk6","updated":"20231120092848"},"Children":[{"Type":"NodeText","Data":"结果：DrawCall为2，每有一个Group，就会产生一个Draw Call。现在是分成了两个Group，所以有两个Draw Call。"}]},{"ID":"20231120092719-gtzpria","Type":"NodeParagraph","Properties":{"id":"20231120092719-gtzpria"}},{"ID":"20231120092600-nsh5zfo","Type":"NodeParagraph","Properties":{"id":"20231120092600-nsh5zfo","updated":"20231120092900"},"Children":[{"Type":"NodeText","Data":"4、三张图片打成一个图集，但是有2个Group，且相互相交"}]},{"ID":"20231120092600-0mzm974","Type":"NodeParagraph","Properties":{"id":"20231120092600-0mzm974","updated":"20231120093033"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic1.zhimg.com/80/v2-7076bfffa1d3a280e6dd2ff47c8ccdc8_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-y4a9owv","Type":"NodeParagraph","Properties":{"id":"20231120092600-y4a9owv","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"结果：DrawCall为2，和第三种情况一样。"}]},{"ID":"20231120092908-qn00pao","Type":"NodeParagraph","Properties":{"id":"20231120092908-qn00pao"}},{"ID":"20231120092600-5kizzsb","Type":"NodeParagraph","Properties":{"id":"20231120092600-5kizzsb","updated":"20231120092916"},"Children":[{"Type":"NodeText","Data":"5、三张图片，打成两个图集，每个图集都是在一个Group上，且不相交"}]},{"ID":"20231120092600-lswwvas","Type":"NodeParagraph","Properties":{"id":"20231120092600-lswwvas","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic4.zhimg.com/80/v2-6af42db1fe227821f85290991bd3377b_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-6tb4wqp","Type":"NodeParagraph","Properties":{"id":"20231120092600-6tb4wqp","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic3.zhimg.com/80/v2-75349a1bd8135d461d858450d51c5eaa_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-1jv87f0","Type":"NodeParagraph","Properties":{"id":"20231120092600-1jv87f0","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"结果：DrawCall为2，情况同上。"}]},{"ID":"20231120094301-zcw7lky","Type":"NodeParagraph","Properties":{"id":"20231120094301-zcw7lky"}},{"ID":"20231120092600-kenejs5","Type":"NodeParagraph","Properties":{"id":"20231120092600-kenejs5","updated":"20231120095228"},"Children":[{"Type":"NodeText","Data":"5.1、两个不同图集的互相相交，都只有1个Group"}]},{"ID":"20231120092600-axkr90a","Type":"NodeParagraph","Properties":{"id":"20231120092600-axkr90a","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic3.zhimg.com/80/v2-fd5b89caf80ae75e2d624aa64e6d92d6_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-ozxa6gw","Type":"NodeParagraph","Properties":{"id":"20231120092600-ozxa6gw","updated":"20231120103510"},"Children":[{"Type":"NodeText","Data":"结果：DrawCall为3，这是因为不同图集之间的互相“有效覆盖”（下面会说），会打断合批处理，看下面的图我们就可以知道同一个图集渲染了两次。"}]},{"ID":"20231120092600-2h0ddjz","Type":"NodeParagraph","Properties":{"id":"20231120092600-2h0ddjz","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic4.zhimg.com/80/v2-3d5ceb532e3d4221359172e763ae1637_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-pd3pexh","Type":"NodeParagraph","Properties":{"id":"20231120092600-pd3pexh","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic2.zhimg.com/80/v2-8fa999ed949abbd0140a8e0fd55ac111_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120094451-c1n6mzz","Type":"NodeParagraph","Properties":{"id":"20231120094451-c1n6mzz","updated":"20231120095245"},"Children":[{"Type":"NodeText","Data":"5.2、还是两个不同图集的互相相交，都只有1个Group"}]},{"ID":"20231120092600-z3erm05","Type":"NodeParagraph","Properties":{"id":"20231120092600-z3erm05","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic2.zhimg.com/80/v2-1c07e19fcda57958db7d8d1848f1c745_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-k7nagss","Type":"NodeParagraph","Properties":{"id":"20231120092600-k7nagss","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"为什么这时候，三张图片互相相交却不是3个DrawCall而是2个DrawCall，明明上面那个情况不是说了不同图集覆盖会打断合批处理吗，为什么这次同一个图集只渲染一次而不是两次就够了？ 我们先看下Hierarchy面板上Canvas下挂载的Image的顺序："}]},{"ID":"20231120092600-59y33ul","Type":"NodeParagraph","Properties":{"id":"20231120092600-59y33ul","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic3.zhimg.com/80/v2-4ae37ffe5ed18fca13164f8dce435dfe_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-aeuwdmc","Type":"NodeParagraph","Properties":{"id":"20231120092600-aeuwdmc","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"我们再把顺序换一下："}]},{"ID":"20231120092600-e3rqhnt","Type":"NodeParagraph","Properties":{"id":"20231120092600-e3rqhnt","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic2.zhimg.com/80/v2-5500f02d52b5816d4b8e5879639e4259_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-aveix5n","Type":"NodeParagraph","Properties":{"id":"20231120092600-aveix5n","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"结果：DrawCall为3。"}]},{"ID":"20231120092600-sznrslj","Type":"NodeParagraph","Properties":{"id":"20231120092600-sznrslj","updated":"20231120095435"},"Children":[{"Type":"NodeText","Data":"结论：Unity的Canvas会按照Hierarchy层级顺序从上向下渲染，所以最下面的UI一般会渲染在最前面。 但是如果UI之间产生了交叉重叠的情况，图集的合批会在不同图集重叠的地方被打断，所以第5.1种情况中的两个图集就产生了3个DrawCall。"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"*注意"},{"Type":"NodeText","Data":"，不同图集重叠情况下合批是否会被打断主要是看Hierarchy层级的顺序，如果两个相同图集之间穿插了另一个不同的图集，则合批会被打断，如果没有，则合批不会被打断，可以看情况5.2。"}]},{"ID":"20231120092600-75j020v","Type":"NodeParagraph","Properties":{"id":"20231120092600-75j020v","updated":"20231120092600"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"同样的，UGUI的Text组件使用的字体文件，每一种字体可以看成一个图集。"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"所以使用Unity自带的Button组件做这个实验也会得到一样的结果："},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"两个相同的btn，不重叠，会产生2个DC。"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"两个相同的btn，交叉重叠，则会产生4个DC。"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120092600-e031501","Type":"NodeParagraph","Properties":{"id":"20231120092600-e031501","updated":"20231120092600"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"从上面的几种情况下，进行总结DrawCall的计算就是，对于DrawCall的计算是在Hierarchy的“层级顺序”上，我们完全可以根据UI“渲染的顺序”与Group去计算将会产生多个Batches"}]},{"ID":"20231120092524-3p5csbz","Type":"NodeParagraph","Properties":{"id":"20231120092524-3p5csbz"}},{"ID":"20231120092524-o0cdi75","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231120092524-o0cdi75","updated":"20231120095914"},"Children":[{"Type":"NodeText","Data":"图集的Depth"}]},{"ID":"20231120095844-vpixy7h","Type":"NodeParagraph","Properties":{"id":"20231120095844-vpixy7h","updated":"20231120100143"},"Children":[{"Type":"NodeText","Data":"Hierarchy的“层级顺序”就是Depth。Depth越大，渲染的时机越晚，也就越在上层（后渲染的在上面）。"}]},{"ID":"20231120100423-gzet45r","Type":"NodeParagraph","Properties":{"id":"20231120100423-gzet45r","updated":"20231120100434"},"Children":[{"Type":"NodeText","Data":"如果父节点嵌套了好多个子节点，它的渲染顺序又是什么，看下面的图片："}]},{"ID":"20231120100423-mt8nwm7","Type":"NodeParagraph","Properties":{"id":"20231120100423-mt8nwm7","updated":"20231120100423"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic1.zhimg.com/80/v2-b0385efa1c1c174850c0c9a5362aaf64_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120100423-akcb1zb","Type":"NodeParagraph","Properties":{"id":"20231120100423-akcb1zb","updated":"20231120100423"},"Children":[{"Type":"NodeText","Data":"规则是：先决定父节点的渲染顺序\u003e再决定每个父节点的子节点的渲染顺序 "}]},{"ID":"20231120100440-zitm92s","Type":"NodeParagraph","Properties":{"id":"20231120100440-zitm92s","updated":"20231120100445"},"Children":[{"Type":"NodeText","Data":"上图从前面的 到后面的排序 NextB \u003e NextA \u003eSubB\u003eSubA\u003eMainA\u003eMainB。"}]},{"ID":"20231120103514-7a1dq3b","Type":"NodeParagraph","Properties":{"id":"20231120103514-7a1dq3b"}},{"ID":"20231120103516-h20autv","Type":"NodeParagraph","Properties":{"id":"20231120103516-h20autv","updated":"20231120103611"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"“有效覆盖”"}]},{"ID":"20231120103631-ix8nvya","Type":"NodeParagraph","Properties":{"id":"20231120103631-ix8nvya","updated":"20231120103637"},"Children":[{"Type":"NodeText","Data":"如下图："}]},{"ID":"20231120103626-d6m0l4j","Type":"NodeParagraph","Properties":{"id":"20231120103626-d6m0l4j","updated":"20231120103626"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic3.zhimg.com/80/v2-6db989b7e125ea5bba2fdb4862d1cd3a_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120103626-gaq7cbm","Type":"NodeParagraph","Properties":{"id":"20231120103626-gaq7cbm","updated":"20231120103626"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://pic4.zhimg.com/80/v2-a3ed4d99e2bdd58f17dba9bd23dbfc33_720w.webp"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231120103626-l8azk4i","Type":"NodeParagraph","Properties":{"id":"20231120103626-l8azk4i","updated":"20231120103739"},"Children":[{"Type":"NodeText","Data":"这四个UI控件它们的Depth分别是：Image的Depth = 0，Image（1）的Depth = 0，Image的Text的Depth = 1，Image（1）的Depth = 0。"}]},{"ID":"20231120104843-s4pu61n","Type":"NodeParagraph","Properties":{"id":"20231120104843-s4pu61n"}},{"ID":"20231120104843-ay9xcjb","Type":"NodeParagraph","Properties":{"id":"20231120104843-ay9xcjb","updated":"20231120104843"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UGUI Depth计算原理总结："}]},{"ID":"20231120104843-kjn0gtp","Type":"NodeParagraph","Properties":{"id":"20231120104843-kjn0gtp","updated":"20231120104920"},"Children":[{"Type":"NodeText","Data":"1、按照Hierarchy节点的顺序，从上向下进行depth分析(深度优先原则)。\n2、跳过那些不渲染的节点，比如active = false，Image脚本Disable、Canvas不渲染的Layer等。\n3、如果处于渲染状态且没有任何其他渲染元素相交，depth = 0。\n4、如果处于渲染状态且有其他渲染元素跟它相交：\n(1)找到相交的渲染元素中最大的depth值，记录为Max Depth；\n(2)判断是否能够与其Batch，如果能Batch，则depth = Max Depth，否则depth= Max Depth + 1；\n5、如果一个渲染元素同时盖住多个其他元素，则我们选取depth值最高的元素，然后回到步骤4。\n6、这里depth的计算是按照Hierarchy顺序的，如果元素A盖住了元素B，而B的depth值还没有计算，这时是无法计算A元素的。"}]},{"ID":"20231120104843-kn12vrc","Type":"NodeParagraph","Properties":{"id":"20231120104843-kn12vrc","updated":"20231120104843"},"Children":[{"Type":"NodeText","Data":"但是这种情况不会出现，因为被盖住的这个元素B总会有值，等B获取了depth值后，A的值可以直接通过B.depth + 1来获得（取决于步骤4的条件）。"}]},{"ID":"20231120104843-tyh6z5i","Type":"NodeParagraph","Properties":{"id":"20231120104843-tyh6z5i","updated":"20231120104843"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"从上面的规则中我们可以看出，depth值与是否相交有关，与是否为子节点无关。"}]},{"ID":"20231120105052-q4y4k2m","Type":"NodeParagraph","Properties":{"id":"20231120105052-q4y4k2m"}},{"ID":"20231120105052-vz0ayjt","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231120105052-vz0ayjt","updated":"20231120105105"},"Children":[{"Type":"NodeText","Data":"图集的优化方案"}]},{"ID":"20231120115115-lzyv15e","Type":"NodeParagraph","Properties":{"id":"20231120115115-lzyv15e","updated":"20231120115115"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意点"}]},{"ID":"20231120115115-tbeiay6","Type":"NodeParagraph","Properties":{"id":"20231120115115-tbeiay6","updated":"20231120115115"},"Children":[{"Type":"NodeText","Data":"1、一个Canvas组件下的元素才会合批，不同Canvas，即使Order in Layer相同也不会合批。"}]},{"ID":"20231120115115-xecv68g","Type":"NodeParagraph","Properties":{"id":"20231120115115-xecv68g","updated":"20231120115115"},"Children":[{"Type":"NodeText","Data":"2、Tag、Layer的不同，是否添加了outLine shadow脚本，这些都不会影响合批。"}]},{"ID":"20231120115115-ml4a2gl","Type":"NodeParagraph","Properties":{"id":"20231120115115-ml4a2gl","updated":"20231120115152"},"Children":[{"Type":"NodeText","Data":"3、不使用UnityWhite等默认Unity的图片，比如：Mast、Sprite和Background等。(这些一般不会被我们不会被打包到图集中，会造成多个Draw Call)"}]},{"ID":"20231120115115-dnd4t7j","Type":"NodeParagraph","Properties":{"id":"20231120115115-dnd4t7j","updated":"20231120115115"},"Children":[{"Type":"NodeText","Data":"4、有时候为了合并层级，比如Text，我们就需要给Text垫高层级，即将Text下面放一个其他图集中的透明图片，从而使得层级整齐，以达到改Text同其他Text层级相同而能合批的目的。"}]},{"ID":"20231120115115-yoqad14","Type":"NodeParagraph","Properties":{"id":"20231120115115-yoqad14","updated":"20231120115115"},"Children":[{"Type":"NodeText","Data":"5、一个节点的RectTransform的Values值不同不会影响合批。"}]},{"ID":"20231120115115-2fzs7zg","Type":"NodeParagraph","Properties":{"id":"20231120115115-2fzs7zg","updated":"20231120115115"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"优化点："}]},{"ID":"20231120115115-3ou6l9n","Type":"NodeParagraph","Properties":{"id":"20231120115115-3ou6l9n","updated":"20231120203148"},"Children":[{"Type":"NodeText","Data":"1、有时候图集会打出多个group，所以我们需要考虑好我们的图片的大小与格式，减少更多的Group产生，尽量把多的图片打到一个Group上，节省空间。"}]},{"ID":"20231120115115-oknug4n","Type":"NodeParagraph","Properties":{"id":"20231120115115-oknug4n","updated":"20231120203219"},"Children":[{"Type":"NodeText","Data":"2、注意Depth，如果合批被打断，会重复加载一遍图集，产生一个新的DrawCall。另外，还需要注意“有效的覆盖部分”是指渲染的元素，而不是整个UI的Rectangle大小。"}]},{"ID":"20231120115115-jctykcn","Type":"NodeParagraph","Properties":{"id":"20231120115115-jctykcn","updated":"20231120203351"},"Children":[{"Type":"NodeText","Data":"3、纹理的格式问题。举例来说，有这样四张纹理格式分别为：RGB24，ETC1，RGBA32和ETC那么设置一样的Tag后，对应的图集就会有四个group分别是：1024x1024,RGBA 32bit；1024x1024,RGB 24bit；128x128,RGBA Compressed ETC@ 8bits；256x256,RGB Compressed ETC 4bits;；比较特别的一点是，某些小的纹理上，可能不带有alpha通道，那么也会被分批到不同的Group上，造成DrawCall的增加。"}]},{"ID":"20231120203456-4rb1nwf","Type":"NodeParagraph","Properties":{"id":"20231120203456-4rb1nwf"}},{"ID":"20231120203457-0pa37d3","Type":"NodeParagraph","Properties":{"id":"20231120203457-0pa37d3"}},{"ID":"20231117154857-s5h61r3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231117154857-s5h61r3","updated":"20231117154905"},"Children":[{"Type":"NodeText","Data":"参考资料"}]},{"ID":"20231117154907-c55p3gb","Type":"NodeParagraph","Properties":{"id":"20231117154907-c55p3gb","updated":"20231117154907"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://zhuanlan.zhihu.com/p/391885850","TextMarkTextContent":"UGUI性能优化——图集(上) - 知乎 (zhihu.com)"}]},{"ID":"20231120204048-7z0q485","Type":"NodeParagraph","Properties":{"id":"20231120204048-7z0q485","updated":"20231120204049"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://zhuanlan.zhihu.com/p/392565481","TextMarkTextContent":"UGUI性能优化——图集之DrawCall优化(下) - 知乎 (zhihu.com)"}]},{"ID":"20231124093051-wk5cbt8","Type":"NodeParagraph","Properties":{"id":"20231124093051-wk5cbt8"}},{"ID":"20231124093052-3wb2wri","Type":"NodeParagraph","Properties":{"id":"20231124093052-3wb2wri","updated":"20231124093052"}},{"ID":"20231124093052-ji5tiqs","Type":"NodeParagraph","Properties":{"id":"20231124093052-ji5tiqs","updated":"20231124093208"},"Children":[{"Type":"NodeText","Data":"sprite打包到图集然后将图集打包到AB包，那么在加载的时候必须先加载图集再加载sprite，无法直接加载sprite"}]},{"ID":"20231124093211-p5yyyqv","Type":"NodeParagraph","Properties":{"id":"20231124093211-p5yyyqv","updated":"20231124093319"},"Children":[{"Type":"NodeText","Data":"sprite打包到图集然后将sprite打包到AB包，AB包中也会有图集生成的纹理，但是在加载的时候可以直接加载sprite。占用的空间稍大"}]},{"ID":"20231124093534-td85o60","Type":"NodeParagraph","Properties":{"id":"20231124093534-td85o60","updated":"20231124094044"},"Children":[{"Type":"NodeText","Data":"打包图集到AB，加载使用图集，可以合批。直接加载sprite白图，找不到sprite"}]},{"ID":"20231124093559-8jveypo","Type":"NodeParagraph","Properties":{"id":"20231124093559-8jveypo","updated":"20231124093857"},"Children":[{"Type":"NodeText","Data":"打包sprite到AB，加载使用sprite，可以合批。先加载图集再加载sprite会报错，找不到图集"}]},{"ID":"20231124094045-8peh6os","Type":"NodeParagraph","Properties":{"id":"20231124094045-8peh6os","updated":"20231124094118"},"Children":[{"Type":"NodeText","Data":"总之打包图集到AB，加载就先加载图集；打包sprite到AB，加载就直接加载sprite"}]}]}