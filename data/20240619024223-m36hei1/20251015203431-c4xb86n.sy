{"ID":"20251015203431-c4xb86n","Spec":"2","Type":"NodeDocument","Properties":{"id":"20251015203431-c4xb86n","title":"Unity UniTask和协程","type":"doc","updated":"20260209142412"},"Children":[{"ID":"20251027180649-scqxre9","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20251027180649-scqxre9","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"UniTask 与 Unity 协程深度对比及使用指南"}]},{"ID":"20251027180649-lff1eh8","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251027180649-lff1eh8","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"核心区别对比表"}]},{"ID":"20251027180649-6kf45u2","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20251027180649-6kf45u2","updated":"20251027180649"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"特性"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Unity 协程 (Coroutine)"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UniTask"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"底层机制"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"基于迭代器 (IEnumerator/yield)"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"基于 C# async/await 状态机"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"性能开销"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"较高 (GC 分配，每帧检查)"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"极低 (值类型，无 GC 分配)"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"生命周期管理"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"依赖 MonoBehaviour 和 GameObject"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"独立于 GameObject"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"错误处理"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"无异常捕获机制"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"完整 try/catch 支持"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"取消操作"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"手动 StopCoroutine()"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"原生 CancellationToken 支持"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"并行处理"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"困难 (需嵌套协程)"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"强大 (WhenAll/WhenAny)"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"返回值"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不支持直接返回值"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"支持 Task\u003cT\u003e 返回值"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"帧控制精度"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"依赖 YieldInstruction"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"精确帧控制 (PlayerLoopTiming)"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"线程支持"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"仅主线程"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"支持多线程切换 (SwitchToThreadPool)"}]}]}]},{"ID":"20251027180649-6qa7bgu","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251027180649-6qa7bgu","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"技术原理剖析"}]},{"ID":"20251027180649-cdu4fw0","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251027180649-cdu4fw0","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Unity 协程工作流"}]},{"ID":"20251027180649-1e0l5qt","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-1e0l5qt","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"IEnumerator MyCoroutine() {\nyield return new WaitForSeconds(1);// 挂起协程\nDebug.Log(\"Resumed after 1 second\"); // Unity 主循环恢复执行\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-m9s7iw5","Type":"NodeList","ListData":{},"Properties":{"id":"20251027180649-m9s7iw5","updated":"20251027180649"},"Children":[{"ID":"20251027180649-mrmlzkn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-mrmlzkn","updated":"20251027180649"},"Children":[{"ID":"20251027180649-gs72jwx","Type":"NodeParagraph","Properties":{"id":"20251027180649-gs72jwx","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"驱动机制"},{"Type":"NodeText","Data":"：Unity 每帧遍历活动协程列表，检查恢复条件"}]}]},{"ID":"20251027180649-k1tf2lk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-k1tf2lk","updated":"20251027180649"},"Children":[{"ID":"20251027180649-9nab07z","Type":"NodeParagraph","Properties":{"id":"20251027180649-9nab07z","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"内存开销"},{"Type":"NodeText","Data":"：每个 yield 产生 ~48B GC 分配（即使 yield return null）"}]}]},{"ID":"20251027180649-b97dbc1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-b97dbc1","updated":"20251027180649"},"Children":[{"ID":"20251027180649-ymdgw0c","Type":"NodeParagraph","Properties":{"id":"20251027180649-ymdgw0c","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"局限性"},{"Type":"NodeText","Data":"：无法在子线程使用，无法直接返回结果"}]}]}]},{"ID":"20251027180649-7xu6vi5","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251027180649-7xu6vi5","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UniTask 工作流"}]},{"ID":"20251027180649-83ukugg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-83ukugg","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTask MyAsyncTask() {\nawait UniTask.Delay(1000);// 挂起任务（不阻塞线程）\nDebug.Log(\"Resumed after 1 second\"); // 由 Unity PlayerLoop 恢复\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-z2n1nxu","Type":"NodeList","ListData":{},"Properties":{"id":"20251027180649-z2n1nxu","updated":"20251027180649"},"Children":[{"ID":"20251027180649-13bm97a","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-13bm97a","updated":"20251027180649"},"Children":[{"ID":"20251027180649-l73o0p3","Type":"NodeParagraph","Properties":{"id":"20251027180649-l73o0p3","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"驱动机制"},{"Type":"NodeText","Data":"：通过注入到 Unity PlayerLoop 的自定义阶段更新"}]}]},{"ID":"20251027180649-5ei5l1z","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-5ei5l1z","updated":"20251027180649"},"Children":[{"ID":"20251027180649-mbfpr5g","Type":"NodeParagraph","Properties":{"id":"20251027180649-mbfpr5g","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"内存优化"},{"Type":"NodeText","Data":"：值类型状态机（struct-based state machine）"}]}]},{"ID":"20251027180649-vdn1uja","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-vdn1uja","updated":"20251027180649"},"Children":[{"ID":"20251027180649-5nbyu79","Type":"NodeParagraph","Properties":{"id":"20251027180649-5nbyu79","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"核心优势"},{"Type":"NodeText","Data":"：零 GC 分配，支持返回值，完整异步控制流"}]}]}]},{"ID":"20251027180649-knk6lmi","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251027180649-knk6lmi","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"何时使用协程？"}]},{"ID":"20251027180649-mqmvexh","Type":"NodeParagraph","Properties":{"id":"20251027180649-mqmvexh","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"在以下场景优先选择协程："}]},{"ID":"20251027180649-z5ps0ad","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-z5ps0ad","updated":"20251027180649"},"Children":[{"ID":"20251027180649-v3sprfg","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20251027180649-v3sprfg","updated":"20251027180649"},"Children":[{"ID":"20251027180649-491j7b2","Type":"NodeParagraph","Properties":{"id":"20251027180649-491j7b2","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"简单延时逻辑"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-d0kb45d","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-d0kb45d","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"IEnumerator HideAfterDelay(GameObject obj) {\nyield return new WaitForSeconds(2);\nobj.SetActive(false);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-99tw3uq","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-99tw3uq","updated":"20251027180649"},"Children":[{"ID":"20251027180649-nh8tkj1","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20251027180649-nh8tkj1","updated":"20251027180649"},"Children":[{"ID":"20251027180649-conhx7b","Type":"NodeParagraph","Properties":{"id":"20251027180649-conhx7b","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"原型快速开发"},{"Type":"NodeText","Data":"：不需要复杂异步流时"}]}]},{"ID":"20251027180649-sf9dq3h","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20251027180649-sf9dq3h","updated":"20251027180649"},"Children":[{"ID":"20251027180649-12zrul4","Type":"NodeParagraph","Properties":{"id":"20251027180649-12zrul4","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"兼容性需求"},{"Type":"NodeText","Data":"：需要支持旧版 Unity（\u003c2018.3）"}]}]}]},{"ID":"20251027180649-75s2lq5","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251027180649-75s2lq5","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"何时使用 UniTask？"}]},{"ID":"20251027180649-6tqneg7","Type":"NodeParagraph","Properties":{"id":"20251027180649-6tqneg7","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"在以下场景必须使用 UniTask："}]},{"ID":"20251027180649-vknt1zu","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-vknt1zu","updated":"20251027180649"},"Children":[{"ID":"20251027180649-1v9t1ba","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20251027180649-1v9t1ba","updated":"20251027180649"},"Children":[{"ID":"20251027180649-c2e02so","Type":"NodeParagraph","Properties":{"id":"20251027180649-c2e02so","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"高性能需求"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-p9n6wp5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-p9n6wp5","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"// 同时加载100个资源零GC\nasync UniTask LoadResources() {\nvar tasks = new UniTask[100];\nfor(int i = 0; i \u003c 100; i++) {\ntasks[i] = LoadResourceAsync(i);\n}\nawait UniTask.WhenAll(tasks);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-sd9wxms","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-sd9wxms","updated":"20251027180649"},"Children":[{"ID":"20251027180649-ajhdg8q","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20251027180649-ajhdg8q","updated":"20251027180649"},"Children":[{"ID":"20251027180649-inpofzt","Type":"NodeParagraph","Properties":{"id":"20251027180649-inpofzt","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"复杂异步流"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-zfyrs1a","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-zfyrs1a","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTask ComplexAsyncFlow() {\n// 步骤1：并行加载资源\nvar (prefab, config) = await UniTask.WhenAll(\nLoadPrefabAsync(\"player\"),\nLoadConfigAsync(\"settings\")\n);\n\n// 步骤2：初始化对象\nvar player = Instantiate(prefab);\nawait player.InitializeAsync(config);\n\n// 步骤3：等待玩家准备就绪\nawait UniTask.WaitUntil(() =\u003e player.IsReady);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-i2gwbsp","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-i2gwbsp","updated":"20251027180649"},"Children":[{"ID":"20251027180649-5fwaixx","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20251027180649-5fwaixx","updated":"20251027180649"},"Children":[{"ID":"20251027180649-t03hu5s","Type":"NodeParagraph","Properties":{"id":"20251027180649-t03hu5s","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"生命周期敏感操作"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-oj43ybk","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-oj43ybk","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"public class Enemy : MonoBehaviour {\nprivate CancellationTokenSource _cts;\n\nvoid OnEnable() {\n_cts = new CancellationTokenSource();\nPatrolAsync(_cts.Token).Forget();\n}\n\nvoid OnDisable() {\n_cts?.Cancel(); // 自动取消任务\n_cts?.Dispose();\n}\n\nasync UniTask PatrolAsync(CancellationToken ct) {\nwhile(!ct.IsCancellationRequested) {\nawait MoveToWaypoint(ct);\n}\n}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-0ralynu","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-0ralynu","updated":"20251027180649"},"Children":[{"ID":"20251027180649-wrwlrzx","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20251027180649-wrwlrzx","updated":"20251027180649"},"Children":[{"ID":"20251027180649-di3e060","Type":"NodeParagraph","Properties":{"id":"20251027180649-di3e060","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"跨线程操作"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-dsvjnu2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-dsvjnu2","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTask ProcessData() {\n// 在子线程执行耗时计算\nvar result = await UniTask.RunOnThreadPool(() =\u003e {\nreturn HeavyCalculation();\n});\n\n// 自动切换回主线程\nawait UniTask.SwitchToMainThread();\nUpdateUI(result);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-cctk17l","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251027180649-cctk17l","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"性能关键指标对比"}]},{"ID":"20251027180649-9h4djvo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-9h4djvo","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"// 性能测试代码\nvoid PerformanceTest() {\n// 协程测试\nStartCoroutine(CoroutineTest(1000));\n\n// UniTask测试\nUniTaskTest(1000).Forget();\n}\n\nIEnumerator CoroutineTest(int count) {\nvar sw = Stopwatch.StartNew();\nfor(int i = 0; i \u003c count; i++) {\nyield return null; // 模拟挂起\n}\nDebug.Log($\"Coroutine: {sw.ElapsedMilliseconds}ms\");\n}\n\nasync UniTask UniTaskTest(int count) {\nvar sw = Stopwatch.StartNew();\nfor(int i = 0; i \u003c count; i++) {\nawait UniTask.Yield();\n}\nDebug.Log($\"UniTask: {sw.ElapsedMilliseconds}ms\");\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-vgc7hlg","Type":"NodeParagraph","Properties":{"id":"20251027180649-vgc7hlg","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"测试结果 (1000次挂起恢复)"},{"Type":"NodeText","Data":"："}]},{"ID":"20251027180649-p1yqer1","Type":"NodeList","ListData":{},"Properties":{"id":"20251027180649-p1yqer1","updated":"20251027180649"},"Children":[{"ID":"20251027180649-9eq1r9f","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-9eq1r9f","updated":"20251027180649"},"Children":[{"ID":"20251027180649-u16txzn","Type":"NodeParagraph","Properties":{"id":"20251027180649-u16txzn","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"协程：~48ms，GC 分配 48KB"}]}]},{"ID":"20251027180649-q95uea1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-q95uea1","updated":"20251027180649"},"Children":[{"ID":"20251027180649-onv536f","Type":"NodeParagraph","Properties":{"id":"20251027180649-onv536f","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"UniTask：~2ms，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"零"},{"Type":"NodeText","Data":" GC 分配"}]}]}]},{"ID":"20251027180649-7ef9dmk","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251027180649-7ef9dmk","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"决策流程图"}]},{"ID":"20251027180649-rwtnw0w","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-rwtnw0w","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"bWVybWFpZA=="},{"Type":"NodeCodeBlockCode","Data":"graph TD\nA[需要异步操作？] --\u003e|是| B{涉及Unity对象？}\nB --\u003e|是| C{需要高性能/零GC？}\nC --\u003e|是| D[使用UniTask]\nC --\u003e|否| E[可用协程快速实现]\nB --\u003e|否| F{需要复杂控制流？}\nF --\u003e|是| D\nF --\u003e|否| G[使用Task.Run]\nA --\u003e|否| H[同步代码]"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-7uu8tcj","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251027180649-7uu8tcj","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"迁移指南"}]},{"ID":"20251027180649-k8puizx","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251027180649-k8puizx","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"协程转 UniTask 模式对照"}]},{"ID":"20251027180649-8dta853","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|","id":"20251027180649-8dta853","updated":"20251027180649"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"协程模式"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UniTask 等效方案"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"yield return null"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"await UniTask.Yield()"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"yield return new WaitForSeconds(3)"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"await UniTask.Delay(3000)"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"yield return StartCoroutine()"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"await OtherTask()"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"yield return WWW"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"await UnityWebRequest"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20251027180649-ue47k0m","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251027180649-ue47k0m","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"混合使用方案"}]},{"ID":"20251027180649-urdf5dj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-urdf5dj","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"// UniTask 驱动协程\nasync UniTask RunCoroutineAsTask() {\nawait StartCoroutine(MyCoroutine()).ToUniTask();\n}\n\n// 协程驱动 UniTask\nIEnumerator RunUniTaskInCoroutine() {\nyield return MyAsyncTask().ToCoroutine();\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-wz03byc","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251027180649-wz03byc","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"高级技巧"}]},{"ID":"20251027180649-4zkoslb","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-4zkoslb","updated":"20251027180649"},"Children":[{"ID":"20251027180649-8xq6uve","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20251027180649-8xq6uve","updated":"20251027180649"},"Children":[{"ID":"20251027180649-nxsteaa","Type":"NodeParagraph","Properties":{"id":"20251027180649-nxsteaa","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"帧精确控制"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-thdmpgr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-thdmpgr","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTask PreciseFrameControl() {\n// 在FixedUpdate后执行\nawait UniTask.WaitForFixedUpdate();\n\n// 在渲染前最后一刻执行\nawait UniTask.WaitForEndOfFrame(this.GetCancellationTokenOnDestroy());\n\n// 指定更新阶段\nawait UniTask.Yield(PlayerLoopTiming.PostLateUpdate);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-udi1kjk","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-udi1kjk","updated":"20251027180649"},"Children":[{"ID":"20251027180649-rubb45c","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20251027180649-rubb45c","updated":"20251027180649"},"Children":[{"ID":"20251027180649-0it4t2h","Type":"NodeParagraph","Properties":{"id":"20251027180649-0it4t2h","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"超时控制"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-mkr4ph8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-mkr4ph8","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTask LoadWithTimeout() {\nusing var cts = new CancellationTokenSource();\ncts.CancelAfterSlim(5000); // 5秒超时\n\nawait LoadLargeAsset().AttachExternalCancellation(cts.Token);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-eajstsg","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-eajstsg","updated":"20251027180649"},"Children":[{"ID":"20251027180649-2o46f84","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20251027180649-2o46f84","updated":"20251027180649"},"Children":[{"ID":"20251027180649-2avp53b","Type":"NodeParagraph","Properties":{"id":"20251027180649-2avp53b","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"进度报告"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-htusg81","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251027180649-htusg81","updated":"20251027180649"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTask LoadWithProgress(IProgress\u003cfloat\u003e progress) {\nfor(int i = 0; i \u003c= 100; i++) {\nawait UniTask.Delay(10);\nprogress.Report(i / 100f);\n}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251027180649-l24l5d7","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251027180649-l24l5d7","updated":"20251118174345"},"Children":[{"Type":"NodeText","Data":"总结建议"}]},{"ID":"20251027180649-p0u4kd7","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-p0u4kd7","updated":"20251027180649"},"Children":[{"ID":"20251027180649-6owhzef","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20251027180649-6owhzef","updated":"20251027180649"},"Children":[{"ID":"20251027180649-dxro44d","Type":"NodeParagraph","Properties":{"id":"20251027180649-dxro44d","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"新项目一律使用 UniTask"},{"Type":"NodeText","Data":"：从架构层面避免协程的技术债务"}]}]},{"ID":"20251027180649-9ndwq5c","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20251027180649-9ndwq5c","updated":"20251027180649"},"Children":[{"ID":"20251027180649-wedrh40","Type":"NodeParagraph","Properties":{"id":"20251027180649-wedrh40","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"旧项目逐步迁移"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-k9desrg","Type":"NodeList","ListData":{},"Properties":{"id":"20251027180649-k9desrg","updated":"20251027180649"},"Children":[{"ID":"20251027180649-n9ef0n2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-n9ef0n2","updated":"20251027180649"},"Children":[{"ID":"20251027180649-vdn9pnu","Type":"NodeParagraph","Properties":{"id":"20251027180649-vdn9pnu","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"优先替换高频调用的协程"}]}]},{"ID":"20251027180649-bpzq44s","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-bpzq44s","updated":"20251027180649"},"Children":[{"ID":"20251027180649-d105m3g","Type":"NodeParagraph","Properties":{"id":"20251027180649-d105m3g","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UniTask.ToCoroutine"},{"Type":"NodeText","Data":"​ 作为过渡"}]}]}]},{"ID":"20251027180649-n8pghjp","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251027180649-n8pghjp","updated":"20251027180649"},"Children":[{"ID":"20251027180649-ogya0t2","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20251027180649-ogya0t2","updated":"20251027180649"},"Children":[{"ID":"20251027180649-5e2whcc","Type":"NodeParagraph","Properties":{"id":"20251027180649-5e2whcc","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"保留协程的场景"},{"Type":"NodeText","Data":"："}]}]}]},{"ID":"20251027180649-p7101sa","Type":"NodeList","ListData":{},"Properties":{"id":"20251027180649-p7101sa","updated":"20251027180649"},"Children":[{"ID":"20251027180649-oonf0r6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-oonf0r6","updated":"20251027180649"},"Children":[{"ID":"20251027180649-tpp9v2t","Type":"NodeParagraph","Properties":{"id":"20251027180649-tpp9v2t","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"简单编辑器工具脚本"}]}]},{"ID":"20251027180649-pyt6inv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-pyt6inv","updated":"20251027180649"},"Children":[{"ID":"20251027180649-qdht784","Type":"NodeParagraph","Properties":{"id":"20251027180649-qdht784","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"不影响性能的简单延时"}]}]},{"ID":"20251027180649-mmmlzyo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-mmmlzyo","updated":"20251027180649"},"Children":[{"ID":"20251027180649-oopyfsu","Type":"NodeParagraph","Properties":{"id":"20251027180649-oopyfsu","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"需要兼容旧 Unity 版本的项目"}]}]}]},{"ID":"20251027180649-fjejxnx","Type":"NodeBlockquote","Properties":{"id":"20251027180649-fjejxnx","updated":"20251027180649"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20251027180649-5d6zjv2","Type":"NodeParagraph","Properties":{"id":"20251027180649-5d6zjv2","updated":"20251027180649"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"扩展学习"},{"Type":"NodeText","Data":"："}]},{"ID":"20251027180649-233dtch","Type":"NodeList","ListData":{},"Properties":{"id":"20251027180649-233dtch","updated":"20251027180649"},"Children":[{"ID":"20251027180649-hqqqmgj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-hqqqmgj","updated":"20251027180649"},"Children":[{"ID":"20251027180649-b4y2n2i","Type":"NodeParagraph","Properties":{"id":"20251027180649-b4y2n2i","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"UniTask 官方文档：https://github.com/Cysharp/UniTask"}]}]},{"ID":"20251027180649-lwlnj8e","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-lwlnj8e","updated":"20251027180649"},"Children":[{"ID":"20251027180649-15jho74","Type":"NodeParagraph","Properties":{"id":"20251027180649-15jho74","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"Unity 异步最佳实践：https://unity.com/how-to/unity-async-await-tasks-and-coroutines"}]}]},{"ID":"20251027180649-h3mltsi","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251027180649-h3mltsi","updated":"20251027180649"},"Children":[{"ID":"20251027180649-mwsk2h5","Type":"NodeParagraph","Properties":{"id":"20251027180649-mwsk2h5","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"高级异步模式："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UniTask.Lazy"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AsyncLazy"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UniTaskCompletionSource"},{"Type":"NodeText","Data":"​"}]}]}]}]},{"ID":"20251027180649-w2ivrri","Type":"NodeParagraph","Properties":{"id":"20251027180649-w2ivrri","updated":"20251027180649"},"Children":[{"Type":"NodeText","Data":"作为有经验的开发者，掌握 UniTask 将大幅提升你的异步编程能力，尤其在大型项目中效果显著。建议优先在性能敏感模块和复杂异步流程中应用 UniTask。"}]},{"ID":"20251118174328-mkyv7js","Type":"NodeParagraph","Properties":{"id":"20251118174328-mkyv7js","updated":"20251118174328"}},{"ID":"20251118174342-oghll3l","Type":"NodeParagraph","Properties":{"id":"20251118174342-oghll3l","updated":"20251118174342"}},{"ID":"20251118174342-gf8fbur","Type":"NodeParagraph","Properties":{"id":"20251118174342-gf8fbur","updated":"20251118174342"}},{"ID":"20251118174345-tov5dio","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20251118174345-tov5dio","updated":"20251118200932"},"Children":[{"Type":"NodeText","Data":"UniTask使用总结"}]},{"ID":"20251118174525-exe9dcj","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251118174525-exe9dcj","updated":"20251118200932"},"Children":[{"ID":"20251118174525-bqy671a","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20251118174525-bqy671a","updated":"20251118174525"},"Children":[{"ID":"20251118174525-ovslcnz","Type":"NodeParagraph","Properties":{"id":"20251118174525-ovslcnz","updated":"20251118174525"},"Children":[{"Type":"NodeText","Data":"使用UniTask时，异步方法需要在async修饰的方法中使用。"}]}]},{"ID":"20251118174525-jb3mmgj","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20251118174525-jb3mmgj","updated":"20251118200649"},"Children":[{"ID":"20251118174525-719mbvm","Type":"NodeParagraph","Properties":{"id":"20251118174525-719mbvm","updated":"20251118200649"},"Children":[{"Type":"NodeText","Data":"启动异步任务的方法（或者不关心结果的方法），返回类型为UniTaskVoid，并且调用时需要使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".Forget()"},{"Type":"NodeText","Data":"​。不要使用async void作为返回类型。"}]},{"ID":"20251118174525-md7xygu","Type":"NodeParagraph","Properties":{"id":"20251118174525-md7xygu","updated":"20251118200635"},"Children":[{"Type":"NodeText","Data":"其他异步方法（被调用的，我们关心其结果的）返回类型应为UniTask（或UniTask"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003c"}]},{"Type":"NodeText","Data":"T"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003e"}]},{"Type":"NodeText","Data":"）。"}]}]},{"ID":"20251118174525-glt0c2o","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20251118174525-glt0c2o","updated":"20251118200738"},"Children":[{"ID":"20251118174525-3848n0y","Type":"NodeParagraph","Properties":{"id":"20251118174525-3848n0y","updated":"20251118200738"},"Children":[{"Type":"NodeText","Data":"避免在构造函数中启动异步任务，因为Unity的组件生命周期在构造函数之后，可能导致空引用。使用异步时需要注意Unity的声明周期，避免销毁后仍然调用。"}]}]},{"ID":"20251118174911-3p4v3ub","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20251118174911-3p4v3ub","updated":"20251118200932"},"Children":[{"ID":"20251118174911-zu1x502","Type":"NodeParagraph","Properties":{"id":"20251118174911-zu1x502","updated":"20251118200932"},"Children":[{"Type":"NodeText","Data":"若异步任务在执行中需要销毁对象，使用取消令牌来正确取消任务。"}]}]},{"ID":"20251118174957-8anjmgq","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20251118174957-8anjmgq","updated":"20251118200755"},"Children":[{"ID":"20251118174957-46v4gfv","Type":"NodeParagraph","Properties":{"id":"20251118174957-46v4gfv","updated":"20251118200755"},"Children":[{"Type":"NodeText","Data":"UniTask需要在方法中使用try-catch来捕获异常。"}]}]}]},{"ID":"20251118180856-3ft9tum","Type":"NodeParagraph","Properties":{"id":"20251118180856-3ft9tum","updated":"20251118180856"}},{"ID":"20251118180857-9nkfuaa","Type":"NodeParagraph","Properties":{"id":"20251118180857-9nkfuaa","updated":"20251118180857"}},{"ID":"20251118174843-0zm915m","Type":"NodeParagraph","Properties":{"id":"20251118174843-0zm915m","updated":"20251118174848"},"Children":[{"Type":"NodeText","Data":"设计异步方法时：\n├── 这是入口点/事件处理程序吗？\n│   ├── 是 → 返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UniTaskVoid"},{"Type":"NodeText","Data":"​ + 调用时使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".Forget()"},{"Type":"NodeText","Data":"​\n│   └── 否 →\n│       ├── 需要返回结果吗？\n│       │   ├── 是 → 返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UniTask\u0026lt;T\u0026gt;"},{"Type":"NodeText","Data":"​\n│       │   └── 否 →\n│       │       ├── 需要等待完成吗？\n│       │       │   ├── 是 → 返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UniTask"},{"Type":"NodeText","Data":"​\n│       │       │   └── 否 → 返回 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UniTaskVoid"},{"Type":"NodeText","Data":"​ + "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".Forget()"},{"Type":"NodeText","Data":"​\n│       │       └──\n│       └──\n└── 记得：永远不要在构造函数中启动异步任务！"}]},{"ID":"20251118180936-0bt8k37","Type":"NodeParagraph","Properties":{"id":"20251118180936-0bt8k37","updated":"20251118180936"}},{"ID":"20251118180936-6gfss9x","Type":"NodeParagraph","Properties":{"id":"20251118180936-6gfss9x","updated":"20251118180936"}},{"ID":"20251118180938-l3ofn91","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251118180938-l3ofn91","updated":"20251118200854"},"Children":[{"Type":"NodeText","Data":"UniTaskVoid和async void的区别"}]},{"ID":"20251118181305-f7kbkxx","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20251118181305-f7kbkxx","updated":"20251118200854"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"特性"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"async void"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UniTaskVoid"},{"Type":"NodeText","Data":"​"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"异常处理"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"异常会直接抛出，可能导致崩溃"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"异常被安全处理，不会崩溃"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"可等待性"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不可等待，调用即忘"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不可等待，但可以跟踪状态"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"取消支持"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"难以取消"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"天然支持取消令牌"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"错误传播"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"错误无法捕获"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"错误可以适当处理"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"内存安全"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"可能内存泄漏"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"更好的生命周期管理"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"推荐使用"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"❌ 避免使用"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"✅ 推荐使用"}]}]}]},{"ID":"20251118195626-nqlw98z","Type":"NodeParagraph","Properties":{"id":"20251118195626-nqlw98z","updated":"20251118195703"},"Children":[{"Type":"NodeText","Data":"即使async void加了try-catch，也不如UniTaskVoid。"}]},{"ID":"20251118195706-0u0qmwj","Type":"NodeList","ListData":{},"Properties":{"id":"20251118195706-0u0qmwj","updated":"20251118200001"},"Children":[{"ID":"20251118195708-j1vzs3g","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251118195708-j1vzs3g","updated":"20251118195708"},"Children":[{"ID":"20251118195708-64i1jre","Type":"NodeParagraph","Properties":{"id":"20251118195708-64i1jre","updated":"20251118195804"},"Children":[{"Type":"NodeText","Data":"无法捕获所有异常"}]}]},{"ID":"20251118195805-e7ug5u6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251118195805-e7ug5u6","updated":"20251118200001"},"Children":[{"ID":"20251118195805-wgq1jcr","Type":"NodeParagraph","Properties":{"id":"20251118195805-wgq1jcr","updated":"20251118200001"},"Children":[{"Type":"NodeText","Data":"取消操作是正常流程，不是异常，async void不会抛出取消操作而是会抛出异常"}]}]}]},{"ID":"20251118181424-yizyn88","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118181424-yizyn88","updated":"20251118194948"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"async void"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"- 危险的火焰"}]},{"ID":"20251118181424-cwyxcu9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118181424-cwyxcu9","style":"line-height: 22px;","updated":"20251118181435"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"QyM="},{"Type":"NodeCodeBlockCode","Data":"async void Start()\n{\n    await UniTask.Delay(1000);\n    // 如果对象在这1秒内被销毁，这里会抛出异常！\n    gameObject.SetActive(false);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118181424-h1t6awj","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118181424-h1t6awj","updated":"20251118195002"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"UniTaskVoid"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"- 安全的替代"}]},{"ID":"20251118181424-k4hmlaq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118181424-k4hmlaq","style":"line-height: 22px;","updated":"20251118181439"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"QyM="},{"Type":"NodeCodeBlockCode","Data":"async UniTaskVoid Start()\n{\n    await UniTask.Delay(1000);\n    // 如果对象被销毁，这里不会执行，不会报错\n    if (this != null) // 额外的安全检查\n        gameObject.SetActive(false);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118193407-maq5di2","Type":"NodeParagraph","Properties":{"id":"20251118193407-maq5di2","updated":"20251118193407"}},{"ID":"20251118195012-vwo1d06","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118195012-vwo1d06","updated":"20251118200247"},"Children":[{"Type":"NodeText","Data":"实例"}]},{"ID":"20251118195035-xr4eq3o","Type":"NodeParagraph","Properties":{"id":"20251118195035-xr4eq3o","updated":"20251118195035"},"Children":[{"Type":"NodeText","Data":"场景1：初始化操作"}]},{"ID":"20251118195035-7xjqu7y","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118195035-7xjqu7y","style":"line-height: 22px;","updated":"20251118195045"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"// ❌ 危险的做法\nasync void Initialize()\n{\n    await LoadConfigAsync();\n    await SetupUIAsync();\n    // 如果对象在加载过程中被销毁，这里会报错\n}\n\n// ✅ 安全的做法\nasync UniTaskVoid Initialize()\n{\n    try\n    {\n        await LoadConfigAsync();\n        if (this == null) return; // 提前退出检查\n        \n        await SetupUIAsync();\n        if (this == null) return;\n        \n        // 安全操作\n    }\n    catch (System.OperationCanceledException)\n    {\n        // 正常取消\n    }\n    catch (System.Exception e)\n    {\n        Debug.LogError($\"初始化失败: {e.Message}\");\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118195035-obdcdyr","Type":"NodeParagraph","Properties":{"id":"20251118195035-obdcdyr","updated":"20251118195035"},"Children":[{"Type":"NodeText","Data":"场景2：UI按钮点击"}]},{"ID":"20251118195035-iyjmasq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118195035-iyjmasq","style":"line-height: 22px;","updated":"20251118195052"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"public class UIButton : MonoBehaviour\n{\n    // ❌ 危险的做法\n    public async void OnClick()\n    {\n        await PlayButtonAnimation();\n        ExecuteBusinessLogic(); // 可能在被销毁的对象上执行\n    }\n    \n    // ✅ 安全的做法\n    public void OnClick()\n    {\n        OnClickAsync().Forget(); // 使用Forget()来调用UniTaskVoid\n    }\n    \n    private async UniTaskVoid OnClickAsync()\n    {\n        var cancellationToken = this.GetCancellationTokenOnDestroy();\n        \n        try\n        {\n            await PlayButtonAnimation().AttachExternalCancellation(cancellationToken);\n            \n            if (this == null) return;\n            \n            ExecuteBusinessLogic();\n        }\n        catch (System.OperationCanceledException)\n        {\n            // 按钮在动画过程中被销毁，正常处理\n        }\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118200245-r3fcy22","Type":"NodeParagraph","Properties":{"id":"20251118200245-r3fcy22","updated":"20251118200245"}},{"ID":"20251118200246-7dys14m","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118200246-7dys14m","updated":"20251125181725"},"Children":[{"Type":"NodeText","Data":".Forget()"}]},{"ID":"20251118200303-9wnl6yk","Type":"NodeParagraph","Properties":{"id":"20251118200303-9wnl6yk","updated":"20251125181725"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":".Forget()"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"的主要作用是：明确告诉编译器\"我知道这个异步方法不需要等待，请忽略警告并安全地执行\"。使用Forget后会立即执行之后的代码，不会等待Forget的UniTask结束。也就是说不要将await和Forget一起使用"}]},{"ID":"20251118201314-pjge8v9","Type":"NodeParagraph","Properties":{"id":"20251118201314-pjge8v9","updated":"20251118201314"}},{"ID":"20251118201304-cthlwqo","Type":"NodeParagraph","Properties":{"id":"20251118201304-cthlwqo","updated":"20251118202659"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"什么时候必须使用.Forget()——不关心结果的时候（即返回值是UniTaskVoid）"}]},{"ID":"20251118201304-g7mf2cf","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118201304-g7mf2cf","style":"line-height: 22px;","updated":"20251118201309"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"// 返回UniTaskVoid的方法必须使用.Forget()\nasync UniTaskVoid MethodA() { }\n\nvoid Caller()\n{\n    MethodA().Forget(); // ✅ 必须\n}\n\n// 返回UniTask的方法可以选择使用.Forget()\nasync UniTask MethodB() { }\n\nvoid Caller2()\n{\n    MethodB().Forget(); // ✅ 可以，表示不关心结果\n    // 或者\n    // await MethodB(); // ✅ 也可以等待\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118201559-q8nmw00","Type":"NodeParagraph","Properties":{"id":"20251118201559-q8nmw00","updated":"20251118201559"}},{"ID":"20251118202416-hnci0ik","Type":"NodeParagraph","Properties":{"id":"20251118202416-hnci0ik","updated":"20251118202735"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果关心结果，就不使用.Forget"}]},{"ID":"20251118201617-z51o9og","Type":"NodeParagraph","Properties":{"id":"20251118201617-z51o9og","updated":"20251118202133"},"Children":[{"Type":"NodeText","Data":"当需要await结果时，不要加.Forget，会丢失返回值，加一层UniTaskVoid和.Forget()，在这里处理返回值。"}]},{"ID":"20251118202944-1bl4rd0","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251118202944-1bl4rd0","updated":"20251118203155"},"Children":[{"ID":"20251118203155-gjyomhb","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20251118203155-gjyomhb","updated":"20251118203155"},"Children":[{"ID":"20251118203155-g71l9zl","Type":"NodeParagraph","Properties":{"id":"20251118203155-g71l9zl","updated":"20251118203155"},"Children":[{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"await"},{"Type":"NodeText","Data":"​ "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"等待任务完成"}]}]}]},{"ID":"20251118202944-szwrn16","Type":"NodeParagraph","Properties":{"id":"20251118202944-szwrn16","updated":"20251118202944"},"Children":[{"Type":"NodeText","Data":"这是最直接的方式："}]},{"ID":"20251118202944-pamxxqn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118202944-pamxxqn","style":"line-height: 22px;","updated":"20251118203056"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTaskVoid Start()\n{\n    Debug.Log(\"开始加载...\");\n    \n    // 等待任务完成\n    await LoadGameDataAsync();\n    \n    // 这里确保任务已经完成\n    Debug.Log(\"加载完成，可以开始游戏！\");\n    InitializeGame();\n}\n\nprivate async UniTask LoadGameDataAsync()\n{\n    await UniTask.Delay(2000); // 模拟加载\n    Debug.Log(\"数据加载完成\");\n}\n//如果是手动调用Start，那么需要加.Forget。如果是Unity的生命周期，不用管\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118202944-ug56eu0","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20251118202944-ug56eu0","updated":"20251118203211"},"Children":[{"ID":"20251118203211-pbnjqo7","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20251118203211-pbnjqo7","updated":"20251118203211"},"Children":[{"ID":"20251118203211-t6nkh7n","Type":"NodeParagraph","Properties":{"id":"20251118203211-t6nkh7n","updated":"20251118203211"},"Children":[{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"获取返回值"}]}]}]},{"ID":"20251118202944-o06sa1i","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118202944-o06sa1i","style":"line-height: 22px;","updated":"20251118203107"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTaskVoid Start()\n{\n    // 等待并获取结果\n    int playerLevel = await LoadPlayerLevelAsync();\n    int coins = await LoadPlayerCoinsAsync();\n    \n    // 使用结果\n    Debug.Log($\"玩家等级: {playerLevel}, 金币: {coins}\");\n    UpdateUI(playerLevel, coins);\n}\n\nprivate async UniTask\u003cint\u003e LoadPlayerLevelAsync()\n{\n    await UniTask.Delay(1000);\n    return 5; // 模拟从服务器获取\n}\n\nprivate async UniTask\u003cint\u003e LoadPlayerCoinsAsync()\n{\n    await UniTask.Delay(800);\n    return 1000; // 模拟从服务器获取\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118203314-m6cym0e","Type":"NodeParagraph","Properties":{"id":"20251118203314-m6cym0e","updated":"20251125181527"},"Children":[{"Type":"NodeText","Data":"总结："}]},{"ID":"20251125181522-lfbq3ia","Type":"NodeList","ListData":{},"Properties":{"id":"20251125181522-lfbq3ia","updated":"20251125181522"},"Children":[{"ID":"20251125181522-tskafje","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251125181522-tskafje","updated":"20251125181522"},"Children":[{"ID":"20251125181522-qmhqu3c","Type":"NodeParagraph","Properties":{"id":"20251125181522-qmhqu3c","updated":"20251125181522"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"await"},{"Type":"NodeText","Data":"​ = 等待 + 关心（结果、异常、取消）"}]}]},{"ID":"20251125181522-9g49kuu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251125181522-9g49kuu","updated":"20251125181522"},"Children":[{"ID":"20251125181522-vjl6fkz","Type":"NodeParagraph","Properties":{"id":"20251125181522-vjl6fkz","updated":"20251125181522"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":".Forget()"},{"Type":"NodeText","Data":"​ = 不等待 + 不关心（即发即弃）"}]}]}]},{"ID":"20251125181522-njiev2j","Type":"NodeParagraph","Properties":{"id":"20251125181522-njiev2j","updated":"20251125181522"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"核心建议："}]},{"ID":"20251125181522-9ljgjn2","Type":"NodeList","ListData":{},"Properties":{"id":"20251125181522-9ljgjn2","updated":"20251125181522"},"Children":[{"ID":"20251125181522-i4i92ap","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251125181522-i4i92ap","updated":"20251125181522"},"Children":[{"ID":"20251125181522-lfer3su","Type":"NodeParagraph","Properties":{"id":"20251125181522-lfer3su","updated":"20251125181522"},"Children":[{"Type":"NodeText","Data":"在需要确保操作完成顺序或处理结果时使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"await"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20251125181522-m2xg3ph","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251125181522-m2xg3ph","updated":"20251125181522"},"Children":[{"ID":"20251125181522-u90pol2","Type":"NodeParagraph","Properties":{"id":"20251125181522-u90pol2","updated":"20251125181522"},"Children":[{"Type":"NodeText","Data":"在即发即弃、不关心结果的场景使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".Forget()"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20251125181522-bmr364i","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251125181522-bmr364i","updated":"20251125181522"},"Children":[{"ID":"20251125181522-upo9srr","Type":"NodeParagraph","Properties":{"id":"20251125181522-upo9srr","updated":"20251125181522"},"Children":[{"Type":"NodeText","Data":"始终为重要的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Forget"},{"Type":"NodeText","Data":"​ 操作设置全局异常处理"}]}]},{"ID":"20251125181522-ma2e0zb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251125181522-ma2e0zb","updated":"20251125181522"},"Children":[{"ID":"20251125181522-uyfe0o6","Type":"NodeParagraph","Properties":{"id":"20251125181522-uyfe0o6","updated":"20251125181522"},"Children":[{"Type":"NodeText","Data":"在性能敏感循环中优先考虑 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Forget"},{"Type":"NodeText","Data":"​ 减少状态机开销"}]}]}]},{"ID":"20251125181520-yuj0igm","Type":"NodeParagraph","Properties":{"id":"20251125181520-yuj0igm","updated":"20251125181520"}},{"ID":"20251118205044-huxfxyr","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118205044-huxfxyr","updated":"20251118205652"},"Children":[{"Type":"NodeText","Data":"取消令牌"}]},{"ID":"20251118205101-ga1hiho","Type":"NodeParagraph","Properties":{"id":"20251118205101-ga1hiho","updated":"20251118205147"},"Children":[{"Type":"NodeText","Data":"当执行异步任务的时候，若对象被销毁，使用取消令牌来确保程序正确执行。"}]},{"ID":"20251118205222-a2cluvj","Type":"NodeList","ListData":{},"Properties":{"id":"20251118205222-a2cluvj","updated":"20251118205652"},"Children":[{"ID":"20251118205229-2h0idva","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251118205229-2h0idva","updated":"20251118205652"},"Children":[{"ID":"20251118205229-5kipfu1","Type":"NodeParagraph","Properties":{"id":"20251118205229-5kipfu1","updated":"20251118205652"},"Children":[{"Type":"NodeText","Data":"方案一：使用CancellationToken"}]}]}]},{"ID":"20251118205213-2yqf6xv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118205213-2yqf6xv","style":"line-height: 22px;","updated":"20251118205234"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"using Cysharp.Threading.Tasks;\nusing System.Threading;\nusing UnityEngine;\n\npublic class SafeDelayExample : MonoBehaviour\n{\n    private CancellationTokenSource _cancellationTokenSource;\n\n    void Start()\n    {\n        _cancellationTokenSource = new CancellationTokenSource();\n        StartDelayedOperation().Forget();\n    }\n\n    async UniTaskVoid StartDelayedOperation()\n    {\n        try\n        {\n            // 传递CancellationToken，界面关闭时会自动取消\n            await UniTask.Delay(3000, cancellationToken: _cancellationTokenSource.Token);\n            \n            // 这里可以安全地操作UI，因为如果界面被关闭，代码不会执行到这里\n            if (this != null) // 额外安全检查\n            {\n                transform.Find(\"SomeElement\").gameObject.SetActive(true);\n                GetComponent\u003cImage\u003e().color = Color.red;\n            }\n        }\n        catch (System.OperationCanceledException)\n        {\n            // 任务被取消，正常退出\n            Debug.Log(\"延迟操作被取消\");\n        }\n    }\n\n    void OnDestroy()\n    {\n        // 关键：取消所有未完成的任务\n        _cancellationTokenSource?.Cancel();\n        _cancellationTokenSource?.Dispose();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118205213-hj6g3ln","Type":"NodeList","ListData":{},"Properties":{"id":"20251118205213-hj6g3ln","updated":"20251118205239"},"Children":[{"ID":"20251118205239-0uld7hc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251118205239-0uld7hc","updated":"20251118205239"},"Children":[{"ID":"20251118205239-bly4w9r","Type":"NodeParagraph","Properties":{"id":"20251118205239-bly4w9r","updated":"20251118205239"},"Children":[{"Type":"NodeText","Data":"方案二：使用GetCancellationTokenOnDestroy()（更简洁）"}]}]}]},{"ID":"20251118205213-hsfu1pp","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118205213-hsfu1pp","style":"line-height: 22px;","updated":"20251118205243"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"using Cysharp.Threading.Tasks;\nusing UnityEngine;\n\npublic class SimpleSafeDelay : MonoBehaviour\n{\n    async void Start()\n    {\n        // 自动获取与GameObject生命周期绑定的CancellationToken\n        var cancellationToken = this.GetCancellationTokenOnDestroy();\n        \n        try\n        {\n            await UniTask.Delay(3000, cancellationToken: cancellationToken);\n            \n            // 只有界面还存在时才会执行到这里\n            if (this != null)\n            {\n                // 安全地更新UI\n                Debug.Log(\"延迟操作完成\");\n            }\n        }\n        catch (System.OperationCanceledException)\n        {\n            // 界面被销毁，任务自动取消\n        }\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118205147-w2goafi","Type":"NodeParagraph","Properties":{"id":"20251118205147-w2goafi","updated":"20251118205147"}},{"ID":"20251118205044-q9smax1","Type":"NodeParagraph","Properties":{"id":"20251118205044-q9smax1","updated":"20251118205044"}},{"ID":"20251118205044-4urcbq7","Type":"NodeParagraph","Properties":{"id":"20251118205044-4urcbq7","updated":"20251118205044"}},{"ID":"20251118203239-y193yot","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251118203239-y193yot","updated":"20251118203356"},"Children":[{"Type":"NodeText","Data":"高级等待模式"}]},{"ID":"20251118203239-3dn0de3","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118203239-3dn0de3","updated":"20251118203356"},"Children":[{"Type":"NodeText","Data":"模式1：并行执行 + 等待所有完成"}]},{"ID":"20251118203239-difq676","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118203239-difq676","style":"line-height: 22px;","updated":"20251118203326"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTaskVoid InitializeGame()\n{\n    Debug.Log(\"开始并行加载...\");\n    \n    // 同时启动多个任务，等待所有完成\n    await UniTask.WhenAll(\n        LoadConfigAsync(),\n        LoadAssetsAsync(),\n        SetupNetworkAsync()\n    );\n    \n    Debug.Log(\"所有并行任务完成！\");\n    StartGameplay();\n}\n\nprivate async UniTask LoadConfigAsync()\n{\n    await UniTask.Delay(1500);\n    Debug.Log(\"配置加载完成\");\n}\n\nprivate async UniTask LoadAssetsAsync()\n{\n    await UniTask.Delay(2000);\n    Debug.Log(\"资源加载完成\");\n}\n\nprivate async UniTask SetupNetworkAsync()\n{\n    await UniTask.Delay(1000);\n    Debug.Log(\"网络设置完成\");\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118203239-b38i2sj","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118203239-b38i2sj","updated":"20251118203412"},"Children":[{"Type":"NodeText","Data":"模式2：等待任意一个完成"}]},{"ID":"20251118203239-tsubx8b","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118203239-tsubx8b","style":"line-height: 22px;","updated":"20251118203401"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTaskVoid WaitForFirstResponse()\n{\n    Debug.Log(\"等待第一个响应...\");\n    \n    // 等待任意一个任务完成\n    var (winningTaskIndex, _) = await UniTask.WhenAny(\n        RequestServerAAsync(),\n        RequestServerBAsync(),\n        RequestServerCAsync()\n    );\n    \n    Debug.Log($\"服务器 {winningTaskIndex + 1} 最先响应\");\n    \n    // 可以继续等待其他任务（可选）\n    await UniTask.WhenAll(/* 剩余任务 */);\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118203239-v6gl1l8","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118203239-v6gl1l8","updated":"20251118203618"},"Children":[{"Type":"NodeText","Data":"模式3：带超时的等待"}]},{"ID":"20251118203239-v15neuj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118203239-v15neuj","style":"line-height: 22px;","updated":"20251118203416"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"async UniTaskVoid LoadWithTimeout()\n{\n    try\n    {\n        // 设置5秒超时\n        var timeoutTask = UniTask.Delay(5000).AsUniTask();\n        var loadTask = LoadLargeAssetAsync();\n        \n        // 等待加载完成或超时\n        var (hasResult, result) = await UniTask.WhenAny(loadTask, timeoutTask);\n        \n        if (hasResult == 0) // 加载任务先完成\n        {\n            Debug.Log($\"加载成功: {result}\");\n        }\n        else // 超时先发生\n        {\n            Debug.LogWarning(\"加载超时！\");\n            // 可以取消加载任务\n        }\n    }\n    catch (Exception e)\n    {\n        Debug.LogError($\"加载失败: {e.Message}\");\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118203613-n3o5m17","Type":"NodeParagraph","Properties":{"id":"20251118203613-n3o5m17","updated":"20251118203613"}},{"ID":"20251118203618-6wwkeok","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251118203618-6wwkeok","updated":"20251118204214"},"Children":[{"Type":"NodeText","Data":"任务状态跟踪"}]},{"ID":"20251118203618-73a02yb","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118203618-73a02yb","updated":"20251118204214"},"Children":[{"Type":"NodeText","Data":"跟踪长时间运行的任务"}]},{"ID":"20251118203618-4nht9r0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118203618-4nht9r0","style":"line-height: 22px;","updated":"20251118203639"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"public class TaskManager : MonoBehaviour\n{\n    private Dictionary\u003cstring, UniTask\u003e activeTasks = new Dictionary\u003cstring, UniTask\u003e();\n    \n    public async UniTask StartTrackedTask(string taskId, UniTask task)\n    {\n        // 存储任务引用\n        activeTasks[taskId] = task;\n        \n        try\n        {\n            await task;\n            Debug.Log($\"任务 {taskId} 完成\");\n        }\n        catch (Exception e)\n        {\n            Debug.LogError($\"任务 {taskId} 失败: {e.Message}\");\n        }\n        finally\n        {\n            activeTasks.Remove(taskId);\n        }\n    }\n    \n    public bool IsTaskRunning(string taskId)\n    {\n        return activeTasks.ContainsKey(taskId) \u0026\u0026 !activeTasks[taskId].GetAwaiter().IsCompleted;\n    }\n    \n    public async UniTask WaitForTask(string taskId)\n    {\n        if (activeTasks.ContainsKey(taskId))\n        {\n            await activeTasks[taskId];\n        }\n    }\n}\n\n// 使用示例\npublic class GameController : MonoBehaviour\n{\n    [SerializeField] private TaskManager taskManager;\n    \n    async UniTaskVoid Start()\n    {\n        // 启动并跟踪任务\n        var saveTask = SaveGameDataAsync();\n        taskManager.StartTrackedTask(\"save_game\", saveTask).Forget();\n        \n        // 可以检查任务状态\n        if (taskManager.IsTaskRunning(\"save_game\"))\n        {\n            Debug.Log(\"保存仍在进行中...\");\n        }\n        \n        // 等待特定任务完成\n        await taskManager.WaitForTask(\"save_game\");\n        Debug.Log(\"保存确认完成！\");\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118204200-2uo2eki","Type":"NodeParagraph","Properties":{"id":"20251118204200-2uo2eki","updated":"20251118204200"}},{"ID":"20251118204207-7yjv0vj","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251118204207-7yjv0vj","updated":"20251210120518"},"Children":[{"Type":"NodeText","Data":"游戏实际应用场景"}]},{"ID":"20251118204207-b0d52wv","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118204207-b0d52wv","updated":"20251210120518"},"Children":[{"Type":"NodeText","Data":"场景1：页面切换动画"}]},{"ID":"20251118204207-1mu4x6n","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118204207-1mu4x6n","style":"line-height: 22px;","updated":"20251118204322"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"public class PageManager : MonoBehaviour\n{\n    public async UniTask SwitchToPage(string pageName)\n    {\n        // 1. 播放退出动画并等待完成\n        await PlayExitAnimationAsync();\n        \n        // 2. 加载新页面并等待完成\n        await LoadNewPageAsync(pageName);\n        \n        // 3. 播放进入动画并等待完成\n        await PlayEnterAnimationAsync();\n        \n        Debug.Log($\"成功切换到页面: {pageName}\");\n    }\n    \n    public async UniTaskVoid OnSettingsButtonClick()\n    {\n        // 等待页面切换完成\n        await SwitchToPage(\"Settings\");\n        \n        // 只有切换完成后才执行\n        InitializeSettings();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251210120518-hj013w9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251210120518-hj013w9","style":"line-height: 22px;","updated":"20251210120518"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"public class PageManager : MonoBehaviour\n{\n    public async UniTask SwitchToPage(string pageName)\n    {\n        // 1. 播放退出动画并等待完成\n        await PlayExitAnimationAsync();\n        \n        // 2. 加载新页面并等待完成\n        await LoadNewPageAsync(pageName);\n        \n        // 3. 播放进入动画并等待完成\n        await PlayEnterAnimationAsync();\n        \n        Debug.Log($\"成功切换到页面: {pageName}\");\n    }\n    \n    public async UniTaskVoid OnSettingsButtonClick()\n    {\n        // 等待页面切换完成\n        await SwitchToPage(\"Settings\");\n        \n        // 只有切换完成后才执行\n        InitializeSettings();\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118204207-0yo7ypx","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118204207-0yo7ypx","updated":"20251118204414"},"Children":[{"Type":"NodeText","Data":"场景2：数据保存流程"}]},{"ID":"20251118204207-qom5mlq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118204207-qom5mlq","style":"line-height: 22px;","updated":"20251118204414"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"public class SaveSystem : MonoBehaviour\n{\n    public async UniTask\u003cbool\u003e SaveGameAsync()\n    {\n        try\n        {\n            // 等待所有保存操作完成\n            await UniTask.WhenAll(\n                SavePlayerDataAsync(),\n                SaveWorldStateAsync(),\n                SaveInventoryAsync()\n            );\n            \n            // 确认保存成功\n            bool saveVerified = await VerifySaveAsync();\n            return saveVerified;\n        }\n        catch (Exception e)\n        {\n            Debug.LogError($\"保存失败: {e.Message}\");\n            return false;\n        }\n    }\n    \n    public async UniTaskVoid OnSaveButtonClick()\n    {\n        // 显示保存中UI\n        ShowSavingUI();\n        \n        // 等待保存完成\n        bool success = await SaveGameAsync();\n        \n        // 根据结果更新UI\n        if (success)\n        {\n            ShowSaveSuccessUI();\n        }\n        else\n        {\n            ShowSaveErrorUI();\n        }\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118204207-e8k21lj","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118204207-e8k21lj","updated":"20251118210001"},"Children":[{"Type":"NodeText","Data":"场景3：资源加载管理"}]},{"ID":"20251118204207-luec3u2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118204207-luec3u2","style":"line-height: 22px;","updated":"20251118204509"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"public class AssetLoader : MonoBehaviour\n{\n    private Dictionary\u003cstring, UniTask\u003cGameObject\u003e\u003e loadingTasks = new Dictionary\u003cstring, UniTask\u003cGameObject\u003e\u003e();\n    \n    public async UniTask\u003cGameObject\u003e LoadAssetAsync(string assetPath)\n    {\n        // 如果已经在加载，返回同一个任务\n        if (loadingTasks.ContainsKey(assetPath))\n        {\n            return await loadingTasks[assetPath];\n        }\n        \n        // 创建新的加载任务\n        var loadTask = ActuallyLoadAssetAsync(assetPath);\n        loadingTasks[assetPath] = loadTask;\n        \n        try\n        {\n            var result = await loadTask;\n            return result;\n        }\n        finally\n        {\n            loadingTasks.Remove(assetPath);\n        }\n    }\n    \n    private async UniTask\u003cGameObject\u003e ActuallyLoadAssetAsync(string path)\n    {\n        // 模拟资源加载\n        await UniTask.Delay(1000);\n        return new GameObject($\"Loaded: {path}\");\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118204753-a2jczr3","Type":"NodeParagraph","Properties":{"id":"20251118204753-a2jczr3","updated":"20251118204753"}},{"ID":"20251118205952-e4lbay2","Type":"NodeParagraph","Properties":{"id":"20251118205952-e4lbay2","updated":"20251118205952"}},{"ID":"20251118210001-54id4h5","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20251118210001-54id4h5","updated":"20251118210037"},"Children":[{"Type":"NodeText","Data":"简洁的时间延迟"}]},{"ID":"20251118205953-hq9z2x7","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118205953-hq9z2x7","updated":"20251118210037"},"Children":[{"Type":"NodeText","Data":"方案一：使用匿名异步方法（最常用）"}]},{"ID":"20251118205953-wrcx2m8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118205953-wrcx2m8","style":"line-height: 22px;","updated":"20251118210029"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"// ✅ 简洁的匿名异步方法\nprivate void Start()\n{\n    // 直接内联写异步逻辑\n    async UniTaskVoid DelayedAction()\n    {\n        await UniTask.Delay(1000); // 等待1秒\n        \n        // 延迟后执行的代码\n        Debug.Log(\"1秒后执行\");\n        transform.localScale = Vector3.one;\n    }\n    \n    DelayedAction().Forget();\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118205953-qcomitj","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118205953-qcomitj","updated":"20251118210038"},"Children":[{"Type":"NodeText","Data":"方案二：使用 UniTask 的 ContinueWith"}]},{"ID":"20251118205953-0l4r3zb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118205953-0l4r3zb","style":"line-height: 22px;","updated":"20251118210046"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"private void SimpleDelay()\n{\n    // 一行代码搞定延迟执行\n    UniTask.Delay(1000)\n          .ContinueWith(() =\u003e Debug.Log(\"1秒后执行\"))\n          .Forget();\n}\n\n// 带取消令牌的版本\nprivate void SafeDelay()\n{\n    UniTask.Delay(1000, cancellationToken: this.GetCancellationTokenOnDestroy())\n          .ContinueWith(() =\u003e \n          {\n              if (this != null)\n                  Debug.Log(\"安全延迟执行\");\n          })\n          .Forget();\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251118205953-vfu844t","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20251118205953-vfu844t","updated":"20251119161446"},"Children":[{"Type":"NodeText","Data":"方案三：使用异步 Lambda 表达式"}]},{"ID":"20251118205953-3th6cj5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20251118205953-3th6cj5","style":"line-height: 22px;","updated":"20251118210123"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y3NoYXJw"},{"Type":"NodeCodeBlockCode","Data":"private void UltraCompactDelay()\n{\n    // 最紧凑的写法\n    UniTask.Void(async () =\u003e\n    {\n        await UniTask.Delay(800);\n        // 延迟后的逻辑\n        PerformAction();\n    });\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20251119161205-539gtfl","Type":"NodeList","ListData":{},"Properties":{"id":"20251119161205-539gtfl","updated":"20251119161437"},"Children":[{"ID":"20251119161437-y8zu1mg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251119161437-y8zu1mg","updated":"20251119161437"},"Children":[{"ID":"20251119161437-nskyyqy","Type":"NodeParagraph","Properties":{"id":"20251119161437-nskyyqy","updated":"20251119161437"},"Children":[{"Type":"NodeText","Data":"UniTask.Void内部已经实现了.Forget，因此不需要再次使用"}]}]}]},{"ID":"20251119161433-a05tepl","Type":"NodeList","ListData":{},"Properties":{"id":"20251119161433-a05tepl","updated":"20251119161440"},"Children":[{"ID":"20251119161440-w8juqvn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251119161440-w8juqvn","updated":"20251119161440"},"Children":[{"ID":"20251119161440-zo35tjs","Type":"NodeParagraph","Properties":{"id":"20251119161440-zo35tjs","updated":"20251119161440"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"简单内联逻辑"},{"Type":"NodeText","Data":" → 优先使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"UniTask.Void"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20251119161433-vsl79cy","Type":"NodeList","ListData":{},"Properties":{"id":"20251119161433-vsl79cy","updated":"20251119161446"},"Children":[{"ID":"20251119161444-yrw82dn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20251119161444-yrw82dn","updated":"20251119161446"},"Children":[{"ID":"20251119161444-hkgvnp2","Type":"NodeParagraph","Properties":{"id":"20251119161444-hkgvnp2","updated":"20251119161446"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"复杂或可复用逻辑"},{"Type":"NodeText","Data":" → 使用单独方法 + "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".Forget()"},{"Type":"NodeText","Data":"​"}]}]}]}]}